<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Amwal Checkout Implementation</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Amwal Checkout Button -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/checkout.esm.js"></script>
    <style type="text/tailwindcss">
        /* Base styles */
        body {
            @apply bg-gray-100 min-h-screen;
        }
        .container {
            @apply mx-auto px-4 py-8 max-w-6xl;
        }

        /* Tabs */
        .tab-active {
            @apply bg-blue-600 text-white;
        }
        .tab-inactive {
            @apply bg-gray-200 hover:bg-gray-300 transition-colors;
        }

        /* Cards and sections */
        .card {
            @apply bg-white rounded-lg shadow-md p-6 mb-6;
        }
        .section-title {
            @apply text-xl font-bold mb-4;
        }

        /* Form elements */
        .form-group {
            @apply mb-4;
        }
        .form-label {
            @apply block text-gray-700 mb-2 font-medium;
        }
        .qty-control {
            @apply flex items-center border rounded-md overflow-hidden;
        }
        .qty-btn {
            @apply py-2 px-4 bg-gray-100 hover:bg-gray-200 transition-colors;
        }
        .qty-input {
            @apply py-2 px-4 text-center w-full;
        }

        /* Payment methods */
        .payment-option {
            @apply flex items-center p-3 border rounded-lg cursor-pointer bg-white hover:bg-gray-50 mb-3 transition-colors;
        }
        .payment-option.selected {
            @apply bg-blue-50 border-blue-300;
        }

        /* Toast notification */
        .toast {
            @apply fixed top-5 right-5 p-4 rounded-lg shadow-lg;
            z-index: 100;
            max-width: 300px;
            transition: all 0.3s ease-in-out;
            transform: translateY(-100px);
            opacity: 0;
        }
        .toast.success {
            @apply bg-green-500 text-white;
        }
        .toast.error {
            @apply bg-red-500 text-white;
        }
        .toast.visible {
            transform: translateY(0);
            opacity: 1;
        }

        /* Debug console */
        .debug-console {
            @apply fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 h-60 overflow-y-auto;
            display: none;
            z-index: 50;
            font-family: monospace;
        }
        .debug-handle {
            @apply fixed bottom-0 right-5 bg-gray-900 text-white px-3 py-1 rounded-t-lg cursor-pointer;
            z-index: 51;
        }
        .debug-entry {
            @apply mb-1 border-l-4 pl-2;
        }
        .debug-entry.INFO {
            @apply border-blue-500;
        }
        .debug-entry.WARN {
            @apply border-yellow-500;
        }
        .debug-entry.ERROR {
            @apply border-red-500;
        }
        .debug-entry.DEBUG {
            @apply border-gray-500;
        }

        /* Loading overlay */
        .loading-overlay {
            @apply fixed inset-0 bg-black/50 flex items-center justify-center;
            z-index: 200;
            display: none;
        }
        .spinner {
            @apply w-10 h-10 border-4 border-white/30 border-t-white rounded-full;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .bg-gray-100{
            background-color: #f3f4f6 !important;
        }
    </style>
</head>
<body class="bg-gray-100">
<div class="container">
    <header class="mb-8">
        <h1 class="text-3xl font-bold text-center text-blue-800">Amwal Checkout Implementation</h1>
        <p class="text-center text-gray-600 mt-2">Complete implementation for both products and services</p>
    </header>

    <!-- Documentation Card -->
    <div class="card">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">Documentation & Getting Started</h2>

        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <h3 class="font-medium text-lg mb-2">Official Documentation</h3>
                <ul class="space-y-2 text-gray-700">
                    <li><a href="https://docs.amwal.tech/reference/getting-started-1#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Api Reference
                    </a></li>

                    <li><a href="https://docs.amwal.tech/docs/woocommerce-installation-guide#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        WooCommerce Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech/docs/magento-installation#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Magento Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech/docs/shopify-installation-guide#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Shopify Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Amwal Documentation
                    </a></li>
                    <li><a href="https://qa-checkout.sa.amwal.tech/?path=/story/components-amwalcheckoutbutton--example&args=merchantId:sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333;enableInstallmentsTimeline:!false"  target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Playground
                    </a></li>
                    <li><a href="https://github.com/amwal-tech/exmaple" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        GitHub Examples
                    </a></li>
                </ul>

                <div class="mt-6 bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="font-medium text-blue-800 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Implementation Notes
                    </h3>
                    <ul class="list-disc list-inside space-y-1 text-blue-900">
                        <li>Ensure you have a valid merchant ID</li>
                        <li>Test in the sandbox environment before going live</li>
                        <li>Always implement proper error handling for failed transactions</li>
                        <li>Use the debug console in this example to track events and troubleshoot issues</li>
                    </ul>
                </div>
            </div>

            <div>
                <h3 class="font-medium text-lg mb-2">Getting Started</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-700">
                    <li>Sign up for an Amwal account at <a href="https://merchant.sa.amwal.tech" class="text-blue-600 hover:underline">merchant.sa.amwal.tech</a></li>
                    <li>Create a new merchant and get your <span class="bg-gray-100 px-1 rounded">merchant-id</span></li>
                    <li>Install the Amwal Checkout button:</li>
                    <div class="bg-gray-100 p-2 rounded my-2 text-sm font-mono">
                        &lt;script type="module" src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/checkout.esm.js"&gt;&lt;/script&gt;
                    </div>
                    <li>Add the Amwal Checkout button to your page:</li>
                    <div class="bg-gray-100 p-2 rounded my-2 text-sm font-mono">
                        &lt;amwal-checkout-button<br>
                        &nbsp;&nbsp;merchant-id="your-merchant-id"<br>
                        &nbsp;&nbsp;amount="100"<br>
                        &nbsp;&nbsp;country-code="SA"<br>
                        &nbsp;&nbsp;locale="en"&gt;<br>
                        &lt;/amwal-checkout-button&gt;
                    </div>
                    <li>Set up event listeners to handle checkout results</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="flex justify-center mb-6">
        <button id="product-tab" class="tab-active py-2 px-4 rounded-l-lg font-medium" aria-selected="true" role="tab">
            Product Example
        </button>
        <button id="service-tab" class="tab-inactive py-2 px-4 rounded-r-lg font-medium" aria-selected="false" role="tab">
            Service Example
        </button>
    </div>

    <!-- Product Checkout Example -->
    <div id="product-content" class="card" role="tabpanel" aria-labelledby="product-tab">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Product Image and Details -->
            <div>
                <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center">
                    <span class="text-gray-500">Product Image</span>
                </div>
                <h2 class="text-xl font-bold mt-4">Premium Wireless Headphones</h2>
                <div class="flex items-center mt-2">
                    <div class="flex text-yellow-400">
                        <!-- 5 stars -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                    </div>
                    <span class="text-gray-600 ml-2">5.0 (128 reviews)</span>
                </div>
                <p class="text-gray-600 mt-4">Experience premium sound quality with these wireless headphones. Features noise cancellation, long battery life, and comfortable ear cushions.</p>

                <div class="mt-4">
                    <h3 class="font-semibold">Features:</h3>
                    <ul class="list-disc pl-5 mt-2 text-gray-600">
                        <li>Active noise cancellation</li>
                        <li>40+ hours of battery life</li>
                        <li>Fast charging - 5min for 3hrs of playback</li>
                        <li>Bluetooth 5.2 connectivity</li>
                    </ul>
                </div>
            </div>

            <!-- Checkout Section -->
            <div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Price:</span>
                        <span class="font-bold" id="product-price">SAR 399.00</span>
                    </div>
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Shipping:</span>
                        <span id="product-shipping">SAR 20.00</span>
                    </div>
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Tax:</span>
                        <span id="product-tax">SAR 21.00</span>
                    </div>
                    <div class="border-t pt-4 mt-4 flex justify-between">
                        <span class="font-bold">Total:</span>
                        <span class="font-bold text-lg" id="product-total">SAR 440.00</span>
                    </div>

                    <div class="mt-6">
                        <label class="form-label" for="product-qty">Quantity:</label>
                        <div class="qty-control">
                            <button id="decrease-qty" class="qty-btn" aria-label="Decrease quantity">-</button>
                            <input type="text" id="product-qty" value="1" readonly class="qty-input" aria-label="Product quantity">
                            <button id="increase-qty" class="qty-btn" aria-label="Increase quantity">+</button>
                        </div>
                    </div>

                    <div class="mt-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium mb-3">Select Payment Method</h3>

                            <div class="space-y-3">
                                <!-- Credit Card Option -->
                                <label class="payment-option selected" id="card-payment-option">
                                    <input type="radio" name="payment-method" value="card" checked class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Credit/Debit Card</div>
                                            <div class="text-sm text-gray-600">Pay the full amount now</div>
                                        </div>
                                    </div>
                                    <div class="ml-auto">
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800">42% OFF</span>
                                    </div>
                                </label>

                                <!-- Installments Option -->
                                <label class="payment-option" id="installment-payment-option">
                                    <input type="radio" name="payment-method" value="installment" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">0% bank installments up to 12 months</div>
                                            <div class="text-sm text-gray-600">Pay in installments with your bank</div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Apple Pay Option -->
                                <label class="payment-option" id="apple-payment-option">
                                    <input type="radio" name="payment-method" value="apple" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M17.005 19.762c-.937 1.382-1.866 2.764-3.414 2.857-1.42.091-1.893-.865-3.544-.865-1.659 0-2.179.865-3.552.923-1.47.065-2.568-1.46-3.551-2.806-1.87-2.736-3.29-7.732-1.396-11.052.898-1.55 2.507-2.52 4.231-2.52 1.659-.037 3.21 1.1 4.231 1.1.939 0 2.694-1.37 4.513-1.16.768.037 2.905.316 4.276 2.318-2.058 1.244-2.986 2.87-2.986 4.876 0 2.488 1.519 4.37 3.192 5.33zm-3.245-17.098c.91-1.096 1.58-2.575 1.397-4.101-1.47.065-3.197.98-4.187 2.114-.91 1.024-1.611 2.576-1.397 4.03 1.524.073 3.116-.846 4.187-2.043z"/>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Apple Pay</div>
                                            <div class="text-sm text-gray-600">Quick checkout with Apple Pay</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Amwal Checkout Buttons Container -->
                        <div id="payment-method-buttons">
                            <!-- Credit Card Payment -->
                            <div id="card-payment" class="payment-button block">
                                <amwal-checkout-button
                                        id="card-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="440"
                                        tax="21"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay Now"
                                        address-required="true"
                                        discount="200"
                                        show-discount-ribbon="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        debug="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Installment Payment -->
                            <div id="installment-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="installment-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="440"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Split Payment"
                                        only-show-bank-installment="true"
                                        address-required="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Apple Pay -->
                            <div id="apple-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="apple-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="440"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay with Apple Pay"
                                        address-required="true"
                                        enable-apple-checkout="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Checkout Example -->
    <div id="service-content" class="card hidden" role="tabpanel" aria-labelledby="service-tab">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Service Details -->
            <div>
                <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center">
                    <span class="text-gray-500">Service Image</span>
                </div>
                <h2 class="text-xl font-bold mt-4">Premium Website Development</h2>
                <div class="flex items-center mt-2">
                    <div class="flex text-yellow-400">
                        <!-- 5 stars -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                    </div>
                    <span class="text-gray-600 ml-2">5.0 (53 reviews)</span>
                </div>
                <p class="text-gray-600 mt-4">Professional website development service tailored to your business needs. Includes responsive design, SEO optimization, and user-friendly interface.</p>

                <div class="mt-4">
                    <h3 class="font-semibold">Service Includes:</h3>
                    <ul class="list-disc pl-5 mt-2 text-gray-600">
                        <li>Custom design based on your requirements</li>
                        <li>Mobile-responsive layout</li>
                        <li>Basic SEO setup</li>
                        <li>Contact form integration</li>
                        <li>3 rounds of revisions</li>
                    </ul>
                </div>
            </div>

            <!-- Checkout Section -->
            <div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Base Price:</span>
                        <span class="font-bold">SAR 2,499.00</span>
                    </div>

                    <div class="mt-4 mb-6">
                        <h3 class="font-semibold mb-3">Select Package:</h3>
                        <div class="space-y-3">
                            <label class="payment-option selected" id="basic-package-option">
                                <input type="radio" name="service-package" value="basic" checked class="mr-3">
                                <div>
                                    <div class="font-medium">Basic Package</div>
                                    <div class="text-sm text-gray-600">5-page website with basic features</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 2,499.00</div>
                            </label>
                            <label class="payment-option" id="standard-package-option">
                                <input type="radio" name="service-package" value="standard" class="mr-3">
                                <div>
                                    <div class="font-medium">Standard Package</div>
                                    <div class="text-sm text-gray-600">10-page website with blog integration</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 3,999.00</div>
                            </label>
                            <label class="payment-option" id="premium-package-option">
                                <input type="radio" name="service-package" value="premium" class="mr-3">
                                <div>
                                    <div class="font-medium">Premium Package</div>
                                    <div class="text-sm text-gray-600">E-commerce website with payment integration</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 5,999.00</div>
                            </label>
                        </div>
                    </div>

                    <div class="border-t pt-4 mt-4 flex justify-between">
                        <span class="font-bold">Total:</span>
                        <span class="font-bold text-lg" id="service-total">SAR 2,499.00</span>
                    </div>

                    <div class="mt-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium mb-3">Select Payment Method</h3>

                            <div class="space-y-3">
                                <!-- Credit Card Option -->
                                <label class="payment-option selected" id="service-card-option">
                                    <input type="radio" name="service-payment-method" value="card" checked class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Credit/Debit Card</div>
                                            <div class="text-sm text-gray-600">Pay the full amount now</div>
                                        </div>
                                    </div>
                                    <div class="ml-auto">
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800">42% OFF</span>
                                    </div>
                                </label>

                                <!-- Installments Option -->
                                <label class="payment-option" id="service-installment-option">
                                    <input type="radio" name="service-payment-method" value="installment" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">0% bank installments up to 12 months</div>
                                            <div class="text-sm text-gray-600">Pay in installments with your bank</div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Apple Pay Option -->
                                <label class="payment-option" id="service-apple-option">
                                    <input type="radio" name="service-payment-method" value="apple" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M17.005 19.762c-.937 1.382-1.866 2.764-3.414 2.857-1.42.091-1.893-.865-3.544-.865-1.659 0-2.179.865-3.552.923-1.47.065-2.568-1.46-3.551-2.806-1.87-2.736-3.29-7.732-1.396-11.052.898-1.55 2.507-2.52 4.231-2.52 1.659-.037 3.21 1.1 4.231 1.1.939 0 2.694-1.37 4.513-1.16.768.037 2.905.316 4.276 2.318-2.058 1.244-2.986 2.87-2.986 4.876 0 2.488 1.519 4.37 3.192 5.33zm-3.245-17.098c.91-1.096 1.58-2.575 1.397-4.101-1.47.065-3.197.98-4.187 2.114-.91 1.024-1.611 2.576-1.397 4.03 1.524.073 3.116-.846 4.187-2.043z"/>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Apple Pay</div>
                                            <div class="text-sm text-gray-600">Quick checkout with Apple Pay</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Service Amwal Checkout Buttons -->
                        <div id="service-payment-buttons">
                            <!-- Credit Card Payment -->
                            <div id="service-card-payment" class="payment-button block">
                                <amwal-checkout-button
                                        id="service-card-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay Now"
                                        address-required="false"
                                        email-required="true"
                                        discount="200"
                                        show-discount-ribbon="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Installment Payment -->
                            <div id="service-installment-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="service-installment-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Split Payment"
                                        only-show-bank-installment="true"
                                        address-required="false"
                                        email-required="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Apple Pay -->
                            <div id="service-apple-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="service-apple-checkout"
                                        merchant-id="sandbox-amwal-b87482f2-55da-486f-9ec5-e2ceb47a0333"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay with Apple Pay"
                                        address-required="false"
                                        enable-apple-checkout="true"
                                        email-required="true"
                                        enable-pre-checkout-trigger="true"
                                        enable-pre-pay-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Integration Security Overview -->
    <div class="card">
        <div class="pb-2 flex items-center justify-between">
            <h2 class="text-xl font-semibold text-blue-700">Integration Security Overview</h2>
        </div>
        <p class="text-gray-700 mb-4">
            Ensuring secure and reliable transactions is central to Amwal Checkout. Below is a comprehensive overview of the security measures implemented throughout the integration lifecycle.
        </p>
        <div class="mt-4">
            <input type="checkbox" id="toggle-security" class="peer hidden">
            <label for="toggle-security" class="flex justify-between items-center cursor-pointer text-blue-600 font-medium mb-2">
                <span>View Details</span>
                <svg class="h-5 w-5 transform transition-transform duration-300 peer-checked:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </label>
            <div class="max-h-0 overflow-hidden transition-all duration-500 peer-checked:max-h-[1000px]">
                <ul class="list-disc pl-5 space-y-3 text-gray-600">
                    <li>
                        <strong>End-to-End Encryption:</strong>
                        All communication between the client (browser/mobile) and Amwal servers is protected using <span class="font-medium">TLS 1.2+</span> with enforced HTTPS. No sensitive data is transmitted over plain channels.
                    </li>
                    <li>
                        <strong>PCI DSS Compliance:</strong>
                        Amwal’s checkout button is a hosted solution, meaning <span class="font-medium">payment details never touch the merchant’s servers</span>. This reduces your PCI scope and ensures compliance with industry standards.
                    </li>
                    <li>
                        <strong>Webhook Signing & Verification:</strong>
                        Amwal uses <code>HMAC-SHA256</code> to sign all webhook payloads. Merchants can verify authenticity using their secret key to ensure data integrity and source trust.
                    </li>
                    <li>
                        <strong>Pre-Checkout Triggers:</strong>
                        Use the <code>amwalPreCheckoutTrigger</code> event to inject customer data, enforce business rules, or perform fraud checks <em>before</em> the payment sheet is shown. This helps stop attacks early in the flow.
                    </li>
                    <li>
                        <strong>Real-Time Address Validation:</strong>
                        During checkout, Amwal provides dynamic address updates, and the merchant can return allowed shipping options. This reduces spoofed address attempts and ensures validated logistics.
                    </li>
                    <li>
                        <strong>Secure Sandbox Environment:</strong>
                        Developers can test integrations in a fully isolated sandbox mode that mirrors production behavior—safe for experimentation, QA, and load testing.
                    </li>
                    <li>
                        <strong>JavaScript Module Isolation:</strong>
                        The Amwal checkout is loaded via ES Modules and sandboxed into an iframe where applicable. This prevents DOM-level tampering and protects your site against script injection attacks.
                    </li>
                    <li>
                        <strong>Debug Console for Auditing:</strong>
                        The built-in debug console captures all transaction events, API calls, and error messages for developers to review and export. This helps in security audits and monitoring integration integrity.
                    </li>
                    <li>
                        <strong>Token-Based Authentication:</strong>
                        Backend endpoints communicating with Amwal must use API keys or OAuth tokens (if applicable). These should be securely stored and rotated periodically.
                    </li>
                </ul>

                <p class="mt-4 text-sm text-gray-500">
                    For full details, integration tips, and compliance support, visit the
                    <a href="https://docs.amwal.tech/security" class="text-blue-600 hover:underline">Amwal Security Documentation</a>.
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Debug Console -->
    <div id="debug-console" class="debug-console">
        <div class="flex justify-between items-center mb-2">
            <div>
                <span class="font-bold">Debug Console</span>
                <span class="ml-2">
                    <button id="debug-clear" class="text-xs bg-red-600 text-white px-2 py-1 rounded">Clear</button>
                    <button id="debug-export" class="text-xs bg-green-600 text-white px-2 py-1 rounded ml-1">Export Logs</button>
                </span>
            </div>
            <div>
                <label class="text-xs mr-2">
                    <input type="checkbox" id="debug-auto-scroll" checked> Auto-scroll
                </label>
                <select id="debug-level" class="text-xs bg-gray-800 text-white px-2 py-1 rounded">
                    <option value="DEBUG">All Levels</option>
                    <option value="INFO">Info & Above</option>
                    <option value="WARN">Warnings & Errors</option>
                    <option value="ERROR">Errors Only</option>
                </select>
            </div>
        </div>
        <div id="debug-content"></div>
    </div>
    <div id="debug-handle" class="debug-handle">Debug</div>
</div>

<!-- JavaScript -->
<script type="module">
    // Logger Module - Handles debugging and logging
    class Logger {
        constructor() {
            this.levels = {
                DEBUG: 0,
                INFO: 1,
                WARN: 2,
                ERROR: 3
            };
            this.currentLevel = this.levels.DEBUG;
            this.consoleOutput = true;
            this.entries = [];
            this.maxEntries = 100;
        }

        debug(message, data) {
            this._log(this.levels.DEBUG, message, data);
            return this;
        }

        info(message, data) {
            this._log(this.levels.INFO, message, data);
            return this;
        }

        warn(message, data) {
            this._log(this.levels.WARN, message, data);
            return this;
        }

        error(message, data) {
            this._log(this.levels.ERROR, message, data);
            return this;
        }

        _log(level, message, data) {
            this._logToConsole(level, message, data);
            this._logToDebugConsole(level, message, data);
            return this;
        }

        _logToConsole(level, message, data) {
            if (!this.consoleOutput) return;

            switch (level) {
                case this.levels.DEBUG:
                    console.debug(message, data || '');
                    break;
                case this.levels.INFO:
                    console.info(message, data || '');
                    break;
                case this.levels.WARN:
                    console.warn(message, data || '');
                    break;
                case this.levels.ERROR:
                    console.error(message, data || '');
                    break;
            }
        }

        _logToDebugConsole(level, message, data) {
            if (level < this.currentLevel) return;

            const debugContent = document.getElementById('debug-content');
            if (!debugContent) return;

            // Create log entry
            const entry = {
                timestamp: new Date(),
                level: Object.keys(this.levels)[level],
                message,
                data
            };

            // Add to entries array
            this.entries.unshift(entry);
            if (this.entries.length > this.maxEntries) {
                this.entries.pop();
            }

            // Create DOM element
            const entryDiv = document.createElement('div');
            entryDiv.className = `debug-entry ${entry.level}`;

            const timestamp = entry.timestamp.toISOString().split('T')[1].slice(0, -1);
            let content = `<span class="text-gray-400">[${timestamp}]</span> <span class="font-bold">[${entry.level}]</span> ${entry.message}`;

            if (data) {
                try {
                    if (typeof data === 'object') {
                        content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">${JSON.stringify(data, null, 2)}</pre>`;
                    } else {
                        content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">${data}</pre>`;
                    }
                } catch (e) {
                    content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">[Object cannot be stringified]</pre>`;
                }
            }

            entryDiv.innerHTML = content;
            debugContent.insertBefore(entryDiv, debugContent.firstChild);

            // Auto-scroll
            if (document.getElementById('debug-auto-scroll').checked) {
                debugContent.scrollTop = 0;
            }
        }

        setLevel(level) {
            if (typeof level === 'string' && this.levels[level] !== undefined) {
                this.currentLevel = this.levels[level];
            } else if (typeof level === 'number' && level >= 0 && level <= 3) {
                this.currentLevel = level;
            }
            return this;
        }

        enableConsole(enable = true) {
            this.consoleOutput = Boolean(enable);
            return this;
        }

        getEntries() {
            return [...this.entries];
        }

        clear() {
            this.entries = [];
            const debugContent = document.getElementById('debug-content');
            if (debugContent) {
                debugContent.innerHTML = '';
            }
            return this;
        }

        export() {
            const exportData = {
                timestamp: new Date().toISOString(),
                entries: this.entries
            };
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportLink = document.createElement('a');
            exportLink.setAttribute('href', dataUri);
            exportLink.setAttribute('download', `amwal-debug-${new Date().toISOString()}.json`);
            document.body.appendChild(exportLink);
            exportLink.click();
            document.body.removeChild(exportLink);
            return this;
        }
    }

    // UI Service - Handles UI related functionality
    class UIService {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                toast: document.getElementById('toast'),
                loadingOverlay: document.getElementById('loading-overlay')
            };
        }

        showToast(message, type = 'success', duration = 3000) {
            const toast = this.elements.toast;
            toast.textContent = message;
            toast.className = `toast ${type}`;

            // Use setTimeout with 10ms to allow the DOM to update before adding the visible class
            setTimeout(() => {
                toast.classList.add('visible');
            }, 10);

            // Hide toast after duration
            setTimeout(() => {
                toast.classList.remove('visible');
            }, duration);

            this.logger.debug(`Toast displayed: ${message}`, { type, duration });
            return this;
        }

        showLoading(show = true) {
            if (show) {
                this.elements.loadingOverlay.style.display = 'flex';
                this.logger.debug('Loading overlay shown');
            } else {
                this.elements.loadingOverlay.style.display = 'none';
                this.logger.debug('Loading overlay hidden');
            }
            return this;
        }
    }

    // TabManager - Handles tab switching functionality
    class TabManager {
        constructor(logger) {
            this.logger = logger;
            this.tabs = {
                product: {
                    tab: document.getElementById('product-tab'),
                    content: document.getElementById('product-content')
                },
                service: {
                    tab: document.getElementById('service-tab'),
                    content: document.getElementById('service-content')
                }
            };
            this.activeTab = 'product';
        }

        init() {
            // Switch to product tab
            this.tabs.product.tab.addEventListener('click', () => this.switchTab('product'));

            // Switch to service tab
            this.tabs.service.tab.addEventListener('click', () => this.switchTab('service'));

            this.logger.info('Tab manager initialized');
            return this;
        }

        switchTab(tabName) {
            if (tabName === this.activeTab) return;

            const tabs = Object.keys(this.tabs);

            // Update active tab
            this.activeTab = tabName;

            // Update UI
            tabs.forEach(tab => {
                if (tab === tabName) {
                    this.tabs[tab].tab.classList.add('tab-active');
                    this.tabs[tab].tab.classList.remove('tab-inactive');
                    this.tabs[tab].tab.setAttribute('aria-selected', 'true');
                    this.tabs[tab].content.classList.remove('hidden');
                } else {
                    this.tabs[tab].tab.classList.remove('tab-active');
                    this.tabs[tab].tab.classList.add('tab-inactive');
                    this.tabs[tab].tab.setAttribute('aria-selected', 'false');
                    this.tabs[tab].content.classList.add('hidden');
                }
            });

            this.logger.info(`Switched to ${tabName} tab`);
            return this;
        }
    }

    // ProductModule - Handles product-related functionality
    class ProductModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                decreaseQty: document.getElementById('decrease-qty'),
                increaseQty: document.getElementById('increase-qty'),
                productQty: document.getElementById('product-qty'),
                productPrice: document.getElementById('product-price'),
                productShipping: document.getElementById('product-shipping'),
                productTax: document.getElementById('product-tax'),
                productTotal: document.getElementById('product-total'),
                cardPayment: document.getElementById('card-payment'),
                installmentPayment: document.getElementById('installment-payment'),
                applePayment: document.getElementById('apple-payment'),
                cardCheckout: document.getElementById('card-checkout'),
                installmentCheckout: document.getElementById('installment-checkout'),
                appleCheckout: document.getElementById('apple-checkout')
            };

            this.state = {
                basePrice: 399,
                shipping: 20,
                taxRate: 0.15,
                quantity: 1,
                tax: 21,
                total: 440,
                shippingMethods: [
                    { id: 'standard', name: 'Standard Shipping', price: 20, deliveryDays: '3-5' },
                    { id: 'express', name: 'Express Shipping', price: 50, deliveryDays: '1-2' },
                    { id: 'same-day', name: 'Same Day Delivery', price: 100, deliveryDays: 'Today' }
                ],
                selectedShippingMethod: 'standard',
                demoAddress: {
                    firstName: 'Mohammed',
                    lastName: 'Al-Saud',
                    addressLine1: '123 King Fahd Road',
                    addressLine2: 'Apartment 4B',
                    city: 'Riyadh',
                    state: 'Riyadh Province',
                    postalCode: '12345',
                    country: 'SA',
                    phoneNumber: '+966501234567',
                    email: 'customer@example.com'
                }
            };
        }

        init() {
            this.initQuantity();
            this.initPaymentMethods();
            this.logger.info('Product module initialized');
            return this;
        }

        initQuantity() {
            // Decrease quantity
            this.elements.decreaseQty.addEventListener('click', () => {
                if (this.state.quantity > 1) {
                    this.state.quantity--;
                    this.updatePrice();
                    this.logger.debug('Quantity decreased', { newQuantity: this.state.quantity });
                } else {
                    this.logger.debug('Cannot decrease quantity below 1');
                }
            });

            // Increase quantity
            this.elements.increaseQty.addEventListener('click', () => {
                this.state.quantity++;
                this.updatePrice();
                this.logger.debug('Quantity increased', { newQuantity: this.state.quantity });
            });

            return this;
        }

        updatePrice() {
            const subtotal = this.state.basePrice * this.state.quantity;
            const tax = Math.round(subtotal * this.state.taxRate);
            const total = subtotal + this.state.shipping + tax;

            this.elements.productQty.value = this.state.quantity;
            this.elements.productPrice.textContent = `SAR ${subtotal.toFixed(2)}`;
            this.elements.productTax.textContent = `SAR ${tax.toFixed(2)}`;
            this.elements.productTotal.textContent = `SAR ${total.toFixed(2)}`;
            this.state.tax = tax;
            this.state.total = total;

            // Update Amwal button amounts
            this.elements.cardCheckout.setAttribute('amount', total.toString());
            this.elements.cardCheckout.setAttribute('tax', tax.toString());
            this.elements.installmentCheckout.setAttribute('amount', total.toString());
            this.elements.appleCheckout.setAttribute('amount', total.toString());

            this.logger.info('Product price updated', { subtotal, tax, total, quantity: this.state.quantity });
            return this;
        }

        initPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="payment-method"]');
            const paymentOptions = document.querySelectorAll('#product-content .payment-option');

            paymentMethods.forEach(method => {
                method.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    paymentOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`${value}-payment-option`).classList.add('selected');

                    // Show correct payment button
                    this.elements.cardPayment.classList.add('hidden');
                    this.elements.installmentPayment.classList.add('hidden');
                    this.elements.applePayment.classList.add('hidden');
                    document.getElementById(`${value}-payment`).classList.remove('hidden');

                    this.logger.info('Product payment method changed', { method: value });
                });
            });

            return this;
        }
    }

    // ServiceModule - Handles service-related functionality
    class ServiceModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                serviceTotal: document.getElementById('service-total'),
                serviceCardPayment: document.getElementById('service-card-payment'),
                serviceInstallmentPayment: document.getElementById('service-installment-payment'),
                serviceApplePayment: document.getElementById('service-apple-payment'),
                serviceCardCheckout: document.getElementById('service-card-checkout'),
                serviceInstallmentCheckout: document.getElementById('service-installment-checkout'),
                serviceAppleCheckout: document.getElementById('service-apple-checkout')
            };

            this.state = {
                packages: {
                    basic: { price: 2499, name: 'Basic Package' },
                    standard: { price: 3999, name: 'Standard Package' },
                    premium: { price: 5999, name: 'Premium Package' }
                },
                selectedPackage: 'basic',
                total: 2499
            };
        }

        init() {
            this.initPackages();
            this.initPaymentMethods();
            this.logger.info('Service module initialized');
            return this;
        }

        initPackages() {
            const servicePackages = document.querySelectorAll('input[name="service-package"]');
            const packageOptions = document.querySelectorAll('#service-content label[id$="-package-option"]');

            servicePackages.forEach(pkg => {
                pkg.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    packageOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`${value}-package-option`).classList.add('selected');

                    // Update price
                    this.updatePackage(value);

                    this.logger.info('Service package changed', { package: value });
                });
            });

            return this;
        }

        updatePackage(packageName) {
            if (this.state.packages[packageName]) {
                this.state.selectedPackage = packageName;
                this.state.total = this.state.packages[packageName].price;

                // Update UI
                this.elements.serviceTotal.textContent = `SAR ${this.state.total.toFixed(2)}`;

                // Update Amwal button amounts
                this.elements.serviceCardCheckout.setAttribute('amount', this.state.total.toString());
                this.elements.serviceInstallmentCheckout.setAttribute('amount', this.state.total.toString());
                this.elements.serviceAppleCheckout.setAttribute('amount', this.state.total.toString());

                this.logger.info('Service package updated', {
                    package: packageName,
                    price: this.state.packages[packageName].price
                });
            }
            return this;
        }

        initPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="service-payment-method"]');
            const paymentOptions = document.querySelectorAll('#service-content .payment-option');

            paymentMethods.forEach(method => {
                method.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    paymentOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`service-${value}-option`).classList.add('selected');

                    // Show correct payment button
                    this.elements.serviceCardPayment.classList.add('hidden');
                    this.elements.serviceInstallmentPayment.classList.add('hidden');
                    this.elements.serviceApplePayment.classList.add('hidden');
                    document.getElementById(`service-${value}-payment`).classList.remove('hidden');

                    this.logger.info('Service payment method changed', { method: value });
                });
            });

            return this;
        }
    }

    // CheckoutModule - Handles Amwal checkout functionality
    class CheckoutModule {
        constructor(logger, uiService, productModule, serviceModule) {
            this.logger = logger;
            this.uiService = uiService;
            this.productModule = productModule;
            this.serviceModule = serviceModule;
        }

        init() {
            this.initProductCheckoutEvents();
            this.initServiceCheckoutEvents();
            this.applyDemoDataToCheckout();
            this.logger.info('Checkout module initialized');
            return this;
        }

        initProductCheckoutEvents() {
            // Add event listeners to product checkout buttons
            const buttons = [
                { el: this.productModule.elements.cardCheckout, type: 'card' },
                { el: this.productModule.elements.installmentCheckout, type: 'installment' },
                { el: this.productModule.elements.appleCheckout, type: 'apple' }
            ];

            buttons.forEach(button => {
                if (button.el) {
                    this._addCheckoutEventListeners(button.el, button.type, true);
                }
            });

            return this;
        }

        initServiceCheckoutEvents() {
            // Add event listeners to service checkout buttons
            const buttons = [
                { el: this.serviceModule.elements.serviceCardCheckout, type: 'card' },
                { el: this.serviceModule.elements.serviceInstallmentCheckout, type: 'installment' },
                { el: this.serviceModule.elements.serviceAppleCheckout, type: 'apple' }
            ];

            buttons.forEach(button => {
                if (button.el) {
                    this._addCheckoutEventListeners(button.el, button.type, false);
                }
            });

            return this;
        }

        _addCheckoutEventListeners(button, buttonType, isProduct = true) {
            const productOrService = isProduct ? 'Product' : 'Service';

            button.addEventListener('amwalPrePayTrigger', (event) => {
                this.logger.info(`${productOrService} pre-pay triggered`, event.detail);

                // The payment details from the event
                const paymentDetails = event.detail || {};
                this.logger.debug('Payment details', paymentDetails);

                // Perform validation here before allowing payment to proceed
                // For example: inventory check, fraud detection, etc.
                const isValid = this._validatePayment(paymentDetails, isProduct);

                if (isValid) {
                    // Allow payment to proceed
                    this.logger.info('Payment validation successful, proceeding with payment');
                    button.dispatchEvent(new CustomEvent('amwalPrePayTriggerAck', {
                        detail: {
                            order_total_amount: paymentDetails.total_amount
                        }
                    }));
                } else {
                    // Abort payment
                    this.logger.error('Payment validation failed, aborting payment');
                    button.dispatchEvent(new CustomEvent('amwalPrePayTriggerError', {
                        detail: {
                            message: 'Payment validation failed. Please try again.'
                        }
                    }));

                    // Optionally show error to user
                    this.uiService.showToast('Payment validation failed. Please try again.', 'error');
                }
            });
            button.addEventListener('amwalPreCheckoutTrigger', (event) => {
                this.logger.info(`${productOrService} pre-checkout triggered`, event.detail);

                // Only add demo data for product checkout
                if (isProduct) {
                    // Get transaction details from the event
                    const transactionDetails = event.detail || {};

                    // Get your demo data
                    const demoAddress = this.productModule.state.demoAddress;
                    const shippingMethod = this.productModule.state.shippingMethods.find(
                        method => method.id === this.productModule.state.selectedShippingMethod
                    );

                    // Create modified transaction details with demo data
                    const modifiedDetails = {
                        ...transactionDetails,
                        customerDetails: {
                            firstName: demoAddress.firstName,
                            lastName: demoAddress.lastName,
                            email: demoAddress.email,
                            phoneNumber: demoAddress.phoneNumber
                        },
                        shippingAddress: {
                            addressLine1: demoAddress.addressLine1,
                            addressLine2: demoAddress.addressLine2,
                            city: demoAddress.city,
                            state: demoAddress.state,
                            postalCode: demoAddress.postalCode,
                            country: demoAddress.country
                        },
                        shippingMethod: {
                            id: shippingMethod.id,
                            name: shippingMethod.name,
                            price: shippingMethod.price,
                            description: `${shippingMethod.name} (${shippingMethod.deliveryDays})`
                        }
                    };

                    this.logger.debug('Sending demo data to Amwal', modifiedDetails);

                    // Send modified transaction details back to Amwal
                    button.dispatchEvent(new CustomEvent('amwalPreCheckoutTriggerAck', {
                        detail: modifiedDetails
                    }));
                } else {
                    // For services, just acknowledge without modification
                    button.dispatchEvent(new CustomEvent('amwalPreCheckoutTriggerAck'));
                }
            });

            // Original checkout events
            button.addEventListener('amwalCheckoutStart', (event) => {
                this.logger.info(`${productOrService} ${buttonType} checkout started`, event.detail);
                this.uiService.showLoading(true);
            });
            button.addEventListener('amwalCheckoutSuccess', (event) => {
                this.logger.info(`${productOrService} ${buttonType} checkout success`, event.detail);
                this.uiService.showLoading(false);
                this.uiService.showToast(`Checkout successful! Order ID: ${event.detail.orderId}`, 'success');
                this.logger.debug('Order details', { orderId: event.detail.orderId });
            });
            button.addEventListener('amwalCheckoutFail', (event) => {
                this.logger.error(`${productOrService} ${buttonType} checkout failed`, event.detail);
                this.uiService.showLoading(false);
                this.uiService.showToast('Checkout failed. Please try again.', 'error');
            });

            // Address events
            button.addEventListener('amwalAddressCountryUpdate', (event) => {
                this.logger.info(`${productOrService} address country updated`, event.detail);
                const country = event.detail;
                this.logger.debug('Country details', country);
            });
            button.addEventListener('amwalAddressStateUpdate', (event) => {
                this.logger.info(`${productOrService} address state updated`, event.detail);
                const state = event.detail;
                this.logger.debug('State details', state);
            });
            button.addEventListener('amwalAddressUpdate', (event) => {
                this.logger.info(`${productOrService} address updated`, event.detail);

                // Only handle shipping methods for products
                if (isProduct) {
                    const address = event.detail;
                    this.logger.debug('Address update received', address);

                    // Get available shipping methods based on the country and city
                    const country = address.country;
                    const city = address.city;

                    // You could customize shipping methods based on location
                    let availableShippingMethods = this.productModule.state.shippingMethods;

                    // Example: If shipping to Riyadh, offer same-day delivery
                    if (country === 'SA' && city === 'Riyadh') {
                        // All shipping methods available
                    }
                    // If shipping to other SA cities, no same-day but express is available
                    else if (country === 'SA') {
                        availableShippingMethods = availableShippingMethods.filter(
                            method => method.id !== 'same-day'
                        );
                    }
                    // International shipping - only standard shipping
                    else {
                        availableShippingMethods = availableShippingMethods.filter(
                            method => method.id === 'standard'
                        );
                    }

                    const shippingOptions = availableShippingMethods.map(method => ({
                        id: method.id,
                        label: method.name,
                        price: method.price,
                    }));

                    this.logger.debug('Sending shipping options to Amwal', shippingOptions);

                    // Create and dispatch the acknowledgment event with shipping options
                    button.dispatchEvent(new CustomEvent('amwalAddressAck', {
                        detail: shippingOptions
                    }));
                }
            });
            button.addEventListener('amwalDismissed', (event) => {
                this.logger.info(`${productOrService} checkout dismissed`, event.detail);
                this.uiService.showLoading(false);
                // Handle modal dismissal
                const isSuccessful = event.detail;
                if (!isSuccessful) {
                    this.uiService.showToast('Checkout was cancelled.', 'error');
                }
            });
            button.addEventListener('updateOrderOnPaymentsuccess', (event) => {
                this.logger.info(`${productOrService} order updated after payment`, event.detail);
                // Update order status in your system
                const orderDetails = event.detail;
                this.logger.debug('Updated order details', orderDetails);

                // Close the modal and then redirect
                if (button && typeof button.dismissModal === 'function') {
                    button.dismissModal().finally(() => {
                        this.logger.info('Modal dismissed, now redirecting');
                    });
                }
            });
        }

        // Validate payment details
        _validatePayment(paymentDetails, isProduct) {
            // Implement your payment validation logic here
            // This is just a simple example

            if (isProduct) {
                // Product-specific validation
                const quantity = this.productModule.state.quantity;
                const isInStock = this._checkInventory(quantity);

                return isInStock;
            } else {
                // Service-specific validation
                const packageType = this.serviceModule.state.selectedPackage;
                const isAvailable = this._checkServiceAvailability(packageType);

                return isAvailable;
            }
        }

        // Sample inventory check method
        _checkInventory(quantity) {
            // In a real application, this would check actual inventory
            // For demo purposes, let's assume we have 10 items in stock
            const inventoryCount = 10;

            this.logger.debug('Checking inventory', { requested: quantity, available: inventoryCount });
            return quantity <= inventoryCount;
        }

        // Sample service availability check
        _checkServiceAvailability(packageType) {
            // In a real application, this would check service availability
            // For demo purposes, let's assume all packages are available
            this.logger.debug('Checking service availability', { package: packageType });
            return true;
        }

        applyDemoDataToCheckout() {
            // Product checkout buttons
            const productCheckoutButtons = [
                this.productModule.elements.cardCheckout,
                this.productModule.elements.installmentCheckout,
                this.productModule.elements.appleCheckout
            ];

            const serviceCheckoutButtons = [
                this.serviceModule.elements.serviceCardCheckout,
                this.serviceModule.elements.serviceInstallmentCheckout,
                this.serviceModule.elements.serviceAppleCheckout
            ];

            // Define shipping methods
            const shippingMethodsData = [
                {
                    id: 'standard',
                    label: 'Standard Shipping',
                    price: 20,
                },
                {
                    id: 'express',
                    label: 'Express Shipping',
                    price: 50,
                },
                {
                    id: 'same-day',
                    label: 'Same Day Delivery',
                    price: 100,
                }
            ];

            // Define all our allowed addresses data
            const addressData = {
                // Initial customer data
                initialFirstName: "Mohammed",
                initialLastName: "Al-Saud",
                initialPhoneNumber: "+966501234567",
                initialEmail: "customer@example.com",

                // Initial address as JSON string
                initialAddress: JSON.stringify({
                    street1: "123 King Fahd Road",
                    street2: "Apartment 4B",
                    city: "Riyadh",
                    state: "Riyadh",
                    country: "SA",
                    postcode: "12345"
                }),

                // Allowed countries
                allowedAddressCountries: JSON.stringify(["SA", "AE", "KW", "US"]),

                // Allowed states by country
                allowedAddressStates: JSON.stringify({
                    "SA": {
                        "1115": "Riyadh",
                        "1119": "Dammam",
                        "1121": "Jeddah",
                        "1122": "Mecca"
                    },
                    "AE": {
                        "1108": "Abu Dhabi",
                        "1111": "Dubai",
                        "1114": "Sharjah"
                    }
                }),

                // Allowed cities by country and state
                allowedAddressCities: JSON.stringify({
                    "SA": {
                        "1115": ["Riyadh"],
                        "1119": ["Dammam"]
                    }
                }),

                // Countries where postcode is optional
                postcodeOptionalCountries: JSON.stringify(["SA"]),

                // Feature flags
                addressHandshake: "",
                sendExtraAddressFields: "",
                enablePrePayTrigger: "",
                enablePreCheckoutTrigger: ""
            };

            // Apply all attributes to each button
            this._applyAttributesToButtons(productCheckoutButtons, addressData, shippingMethodsData, true);
            this._applyAttributesToButtons(serviceCheckoutButtons, addressData, null, false);

            this.logger.info('Demo customer and address data applied to checkout buttons', {
                customerData: {
                    firstName: addressData.initialFirstName,
                    lastName: addressData.initialLastName,
                    phoneNumber: addressData.initialPhoneNumber,
                    email: addressData.initialEmail
                },
                addressData: JSON.parse(addressData.initialAddress),
                allowedCountries: JSON.parse(addressData.allowedAddressCountries)
            });

            return this;
        }

        _applyAttributesToButtons(buttons, addressData, shippingMethodsData, isProduct) {
            buttons.forEach(button => {
                if (!button) return;

                // Set customer information
                button.setAttribute('initial-first-name', addressData.initialFirstName);
                button.setAttribute('initial-last-name', addressData.initialLastName);
                button.setAttribute('initial-phone-number', addressData.initialPhoneNumber);
                button.setAttribute('initial-email', addressData.initialEmail);

                // Set address information
                button.setAttribute('initial-address', addressData.initialAddress);

                // Set address restrictions
                button.setAttribute('allowed-address-countries', addressData.allowedAddressCountries);
                button.setAttribute('allowed-address-states', addressData.allowedAddressStates);
                button.setAttribute('allowed-address-cities', addressData.allowedAddressCities);
                button.setAttribute('postcode-optional-countries', addressData.postcodeOptionalCountries);

                // Set feature flags
                button.setAttribute('address-handshake', addressData.addressHandshake);
                button.setAttribute('send-extra-address-fields', addressData.sendExtraAddressFields);
                button.setAttribute('enable-pre-pay-trigger', addressData.enablePrePayTrigger);
                button.setAttribute('enable-pre-checkout-trigger', addressData.enablePreCheckoutTrigger);

                // Dynamic shipping details is not needed if we're providing allowed addresses
                button.setAttribute('enable-dynamic-shipping-details', 'false');

                // Only add shipping methods to product buttons
                if (isProduct && shippingMethodsData) {
                    button.setAttribute('shipping-methods', JSON.stringify(shippingMethodsData));
                }
            });
        }
    }

    // DebugModule - Handles debug console functionality
    class DebugModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                debugConsole: document.getElementById('debug-console'),
                debugHandle: document.getElementById('debug-handle'),
                debugContent: document.getElementById('debug-content'),
                debugClear: document.getElementById('debug-clear'),
                debugExport: document.getElementById('debug-export'),
                debugLevel: document.getElementById('debug-level'),
                debugAutoScroll: document.getElementById('debug-auto-scroll')
            };
        }

        init() {
            // Toggle debug console visibility
            this.elements.debugHandle.addEventListener('click', () => {
                const debugConsole = this.elements.debugConsole;
                if (debugConsole.style.display === 'block') {
                    debugConsole.style.display = 'none';
                } else {
                    debugConsole.style.display = 'block';
                }
                this.logger.debug('Debug console toggled');
            });

            // Clear debug console
            this.elements.debugClear.addEventListener('click', () => {
                this.logger.clear();
                this.logger.info('Debug console cleared');
            });

            // Export debug logs
            this.elements.debugExport.addEventListener('click', () => {
                this.logger.export();
                this.logger.info('Debug logs exported');
            });

            // Change debug level
            this.elements.debugLevel.addEventListener('change', (event) => {
                const level = event.target.value;
                this.logger.setLevel(level);
                this.logger.info('Debug level changed', { level });
            });

            this.logger.info('Debug module initialized');
            return this;
        }
    }

    // AmwalCheckoutApp - Main application class
    class AmwalCheckoutApp {
        constructor() {
            // Initialize logger first
            this.logger = new Logger();
            this.logger.info('Initializing Amwal Checkout application', { timestamp: new Date().toISOString() });

            // Initialize services and modules
            this.uiService = new UIService(this.logger);
            this.tabManager = new TabManager(this.logger);
            this.productModule = new ProductModule(this.logger);
            this.serviceModule = new ServiceModule(this.logger);
            this.checkoutModule = new CheckoutModule(this.logger, this.uiService, this.productModule, this.serviceModule);
            this.debugModule = new DebugModule(this.logger);
        }

        init() {
            // Initialize all modules
            this.tabManager.init();
            this.productModule.init();
            this.serviceModule.init();
            this.checkoutModule.init();
            this.debugModule.init();

            this.logger.info('AmwalCheckoutApp initialized successfully');
            return this;
        }
    }

    // Initialize the application when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        const app = new AmwalCheckoutApp();
        app.init();
    });
</script>
</body>
</html>
