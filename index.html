<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0" />
    <title>Amwal Checkout Implementation</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Amwal Checkout Button -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/checkout.esm.js"></script>
    <style type="text/tailwindcss">
        /* Base styles */
        body {
            @apply bg-gray-100 min-h-screen;
        }
        .container {
            @apply mx-auto px-4 py-8 max-w-6xl;
        }

        /* Tabs */
        .tab-active {
            @apply bg-blue-600 text-white;
        }
        .tab-inactive {
            @apply bg-gray-200 hover:bg-gray-300 transition-colors;
        }

        /* Cards and sections */
        .card {
            @apply bg-white rounded-lg shadow-md p-6 mb-6;
        }
        .section-title {
            @apply text-xl font-bold mb-4;
        }

        /* Form elements */
        .form-group {
            @apply mb-4;
        }
        .form-label {
            @apply block text-gray-700 mb-2 font-medium;
        }
        .qty-control {
            @apply flex items-center border rounded-md overflow-hidden;
        }
        .qty-btn {
            @apply py-2 px-4 bg-gray-100 hover:bg-gray-200 transition-colors;
        }
        .qty-input {
            @apply py-2 px-4 text-center w-full;
        }

        /* Payment methods */
        .payment-option {
            @apply flex items-center p-3 border rounded-lg cursor-pointer bg-white hover:bg-gray-50 mb-3 transition-colors;
        }
        .payment-option.selected {
            @apply bg-blue-50 border-blue-300;
        }

        /* Toast notification */
        .toast {
            @apply fixed top-5 right-5 p-4 rounded-lg shadow-lg;
            z-index: 100;
            max-width: 300px;
            transition: all 0.3s ease-in-out;
            transform: translateY(-100px);
            opacity: 0;
        }
        .toast.success {
            @apply bg-green-500 text-white;
        }
        .toast.error {
            @apply bg-red-500 text-white;
        }
        .toast.visible {
            transform: translateY(0);
            opacity: 1;
        }

        /* Debug console */
        .debug-console {
            @apply fixed bottom-0 left-0 right-0 bg-gray-900 text-white p-4 h-60 overflow-y-auto;
            display: none;
            z-index: 50;
            font-family: monospace;
        }
        .debug-handle {
            @apply fixed bottom-0 right-5 bg-gray-900 text-white px-3 py-1 rounded-t-lg cursor-pointer;
            z-index: 51;
        }
        .debug-entry {
            @apply mb-1 border-l-4 pl-2;
        }
        .debug-entry.INFO {
            @apply border-blue-500;
        }
        .debug-entry.WARN {
            @apply border-yellow-500;
        }
        .debug-entry.ERROR {
            @apply border-red-500;
        }
        .debug-entry.DEBUG {
            @apply border-gray-500;
        }

        /* Loading overlay */
        .loading-overlay {
            @apply fixed inset-0 bg-black/50 flex items-center justify-center;
            z-index: 200;
            display: none;
        }
        .spinner {
            @apply w-10 h-10 border-4 border-white/30 border-t-white rounded-full;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .bg-gray-100{
            background-color: #f3f4f6 !important;
        }
    </style>
</head>
<body class="bg-gray-100">
<div class="container">
    <header class="mb-8">
        <h1 class="text-3xl font-bold text-center text-blue-800">Amwal Checkout Implementation</h1>
        <p class="text-center text-gray-600 mt-2">Complete implementation for both products and services</p>
    </header>

    <!-- Documentation Card -->
    <div class="card">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">Documentation & Getting Started</h2>

        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <h3 class="font-medium text-lg mb-2">Official Documentation</h3>
                <ul class="space-y-2 text-gray-700">
                    <li><a href="https://docs.amwal.tech/reference/getting-started-1#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Api Reference
                    </a></li>

                    <li><a href="https://docs.amwal.tech/docs/woocommerce-installation-guide#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        WooCommerce Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech/docs/magento-installation#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Magento Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech/docs/shopify-installation-guide#/" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Shopify Plugin
                    </a></li>
                    <li><a href="https://docs.amwal.tech" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Amwal Documentation
                    </a></li>
                    <li><a href="https://qa-checkout.sa.amwal.tech/?path=/story/components-amwalcheckoutbutton--example&args=merchantId:sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47;enableInstallmentsTimeline:!false"  target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Playground
                    </a></li>
                    <li><a href="https://github.com/amwal-tech/exmaple" class="text-blue-600 hover:underline flex items-center" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        GitHub Examples
                    </a></li>
                </ul>

                <div class="mt-6 bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="font-medium text-blue-800 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Implementation Notes
                    </h3>
                    <ul class="list-disc list-inside space-y-1 text-blue-900">
                        <li>Ensure you have a valid merchant ID</li>
                        <li>Test in the sandbox environment before going live</li>
                        <li>Always implement proper error handling for failed transactions</li>
                        <li>Use the debug console in this example to track events and troubleshoot issues</li>
                    </ul>
                </div>
            </div>

            <div>
                <h3 class="font-medium text-lg mb-2">Getting Started</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-700">
                    <li>Sign up for an Amwal account at <a href="https://merchant.sa.amwal.tech" class="text-blue-600 hover:underline">merchant.sa.amwal.tech</a></li>
                    <li>Create a new merchant and get your <span class="bg-gray-100 px-1 rounded">merchant-id</span></li>
                    <li>Install the Amwal Checkout button:</li>
                    <div class="bg-gray-100 p-2 rounded my-2 text-sm font-mono">
                        &lt;script type="module" src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/checkout.esm.js"&gt;&lt;/script&gt;
                    </div>
                    <li>Add the Amwal Checkout button to your page:</li>
                    <div class="bg-gray-100 p-2 rounded my-2 text-sm font-mono">
                        &lt;amwal-checkout-button<br>
                        &nbsp;&nbsp;merchant-id="your-merchant-id"<br>
                        &nbsp;&nbsp;amount="100"<br>
                        &nbsp;&nbsp;country-code="SA"<br>
                        &nbsp;&nbsp;locale="en"&gt;<br>
                        &lt;/amwal-checkout-button&gt;
                    </div>
                    <li>Set up event listeners to handle checkout results</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="flex justify-center mb-6">
        <button id="product-tab" class="tab-active py-2 px-4 rounded-l-lg font-medium" aria-selected="true" role="tab">
            Product Example
        </button>
        <button id="service-tab" class="tab-inactive py-2 px-4 rounded-r-lg font-medium" aria-selected="false" role="tab">
            Service Example
        </button>
    </div>

    <!-- Product Checkout Example -->
    <div id="product-content" class="card" role="tabpanel" aria-labelledby="product-tab">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Product Image and Details -->
            <div>
                <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center">
                    <span class="text-gray-500">Product Image</span>
                </div>
                <h2 class="text-xl font-bold mt-4">Premium Wireless Headphones</h2>
                <div class="flex items-center mt-2">
                    <div class="flex text-yellow-400">
                        <!-- 5 stars -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                    </div>
                    <span class="text-gray-600 ml-2">5.0 (128 reviews)</span>
                </div>
                <p class="text-gray-600 mt-4">Experience premium sound quality with these wireless headphones. Features noise cancellation, long battery life, and comfortable ear cushions.</p>

                <div class="mt-4">
                    <h3 class="font-semibold">Features:</h3>
                    <ul class="list-disc pl-5 mt-2 text-gray-600">
                        <li>Active noise cancellation</li>
                        <li>40+ hours of battery life</li>
                        <li>Fast charging - 5min for 3hrs of playback</li>
                        <li>Bluetooth 5.2 connectivity</li>
                    </ul>
                </div>

                <div class="amwal-installment-cta mt-4 border border-gray-300 rounded-lg p-3 cursor-pointer hover:bg-gray-50 transition-colors" id="installment-cta-button">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="bg-black rounded mr-2">
                                <svg width="72" height="29" viewBox="0 0 72 29" fill="none" xmlns="http://www.w3.org/2000/svg" class="amwal-logo">
                                    <rect width="72" height="28.946" rx="6" fill="black"></rect>
                                    <path d="M24.1912 11.6545C25.5297 10.5672 27.8358 10.9347 28.8503 12.3232C28.8972 12.3845 28.9818 12.3896 29.0287 12.3334C29.0804 12.2722 29.1274 12.2109 29.179 12.1547C29.7191 11.5626 30.3861 11.241 31.1328 11.0981C31.9219 10.9449 32.7015 10.9909 33.453 11.3125C34.3641 11.7004 34.9794 12.4253 35.3598 13.3901C35.6369 14.0843 35.7684 14.8194 35.7731 15.5698C35.7825 17.1216 35.7778 18.6785 35.7872 20.2303C35.7872 20.3579 35.7543 20.3783 35.6463 20.3783C34.9512 20.3732 34.2561 20.3732 33.5657 20.3783C33.453 20.3783 33.4201 20.3528 33.4201 20.2252C33.4248 18.7551 33.4248 17.2849 33.4248 15.8148C33.4248 15.386 33.359 14.9725 33.1712 14.5897C32.5747 13.3748 31.0859 13.2522 30.3109 14.36C30.015 14.7836 29.8741 15.2686 29.8741 15.7944C29.8741 17.2747 29.8741 18.7551 29.8788 20.2354C29.8788 20.3528 29.8506 20.3783 29.7473 20.3783C29.0381 20.3732 28.3242 20.3732 27.615 20.3783C27.5211 20.3783 27.4976 20.3528 27.4976 20.2507C27.5023 18.7704 27.4976 17.29 27.5023 15.8097C27.5023 15.534 27.4788 15.2584 27.4178 14.9878C27.244 14.263 26.6804 13.7168 25.9994 13.6147C24.9521 13.4564 24.3227 14.314 24.1161 15.0644C24.0409 15.3298 24.0127 15.6004 24.0127 15.8811C24.0127 17.29 24.0127 18.704 24.0174 20.1129C24.0174 20.2609 23.9094 20.3783 23.7732 20.3783C23.1016 20.3732 22.43 20.3732 21.7536 20.3783C21.655 20.3783 21.6362 20.3477 21.6362 20.2507C21.6409 17.2798 21.6409 14.314 21.6362 11.3431C21.6362 11.2512 21.6503 11.2206 21.7443 11.2206C22.4675 11.2257 23.1908 11.2257 23.9141 11.2206C23.9892 11.2206 24.0174 11.2359 24.0127 11.3227C24.008 11.4044 24.008 11.4809 24.008 11.5626C24.008 11.6596 24.1161 11.7157 24.1912 11.6545Z" fill="white"></path>
                                    <path d="M43.8655 20.384C43.8233 20.4759 43.7012 20.4759 43.6589 20.384C43.3724 19.7357 43.0906 19.0976 42.8088 18.4595C42.527 17.8215 42.2452 17.1885 41.9634 16.5402C41.9211 16.4432 41.799 16.4432 41.7568 16.5402C41.1885 17.8266 40.6249 19.0976 40.0566 20.3942C40.0143 20.4861 39.8969 20.4912 39.8499 20.3993C38.3564 17.3314 36.8723 14.2839 35.374 11.216C35.4304 11.216 35.468 11.216 35.5055 11.216C36.2993 11.216 37.0977 11.216 37.8914 11.2109C37.9807 11.2109 38.0229 11.2467 38.0605 11.3283C38.6899 12.7117 39.3239 14.09 39.9579 15.4733C39.9767 15.509 39.9908 15.5448 40.019 15.606C40.1364 15.3406 40.2444 15.0905 40.3478 14.8454C40.4793 14.5494 40.6061 14.2482 40.7376 13.9521C40.7705 13.8807 40.7705 13.8245 40.7376 13.7479C40.39 12.9516 40.0425 12.1502 39.6996 11.3488C39.6855 11.313 39.6668 11.2773 39.6527 11.2365C39.6761 11.2007 39.709 11.216 39.7372 11.216C40.4323 11.216 41.1274 11.216 41.8225 11.2109C41.9024 11.2109 41.9399 11.2416 41.9728 11.3181C42.5881 12.7219 43.208 14.1257 43.828 15.5295C43.8327 15.5397 43.8421 15.5499 43.8609 15.5754C43.9595 15.3304 44.0581 15.1007 44.152 14.8659C44.6264 13.6867 45.1055 12.5075 45.5751 11.3283C45.6127 11.2365 45.655 11.2109 45.7442 11.2109C46.4393 11.216 47.1344 11.2109 47.8295 11.2109C47.8671 11.2109 47.9047 11.2109 47.9563 11.2109C46.5896 14.2788 45.2323 17.3212 43.8655 20.384Z" fill="white"></path>
                                    <path d="M59.6416 13.6148C59.6416 15.8149 59.6416 18.015 59.6463 20.2151C59.6463 20.3376 59.6275 20.3733 59.5054 20.3733C58.7962 20.3682 58.0824 20.3682 57.3732 20.3733C57.2839 20.3733 57.2651 20.3478 57.2651 20.2508C57.2698 15.8302 57.2698 11.4096 57.2651 6.99405C57.2651 6.88175 57.298 6.86133 57.3919 6.86133C58.0964 6.86643 58.8056 6.86643 59.5101 6.86133C59.6228 6.86133 59.6463 6.89196 59.6463 7.01447C59.6369 9.21457 59.6416 11.4147 59.6416 13.6148Z" fill="white"></path>
                                    <path d="M56.11 11.3788C56.11 11.3584 56.1053 11.3329 56.11 11.3125C56.1194 11.241 56.0959 11.2206 56.0255 11.2206C55.3304 11.2206 54.6306 11.2206 53.9355 11.2206C53.8228 11.2206 53.7335 11.3176 53.7335 11.4401C53.7335 11.486 53.7335 11.532 53.7335 11.5779C53.7335 11.68 53.6255 11.7362 53.5504 11.68C53.0478 11.2818 52.4842 11.0725 51.8737 11.0368C50.6244 10.9602 49.5676 11.4707 48.7316 12.4661C47.689 13.7117 47.3414 15.1869 47.6326 16.8306C47.9755 18.7397 49.3938 20.3579 51.2866 20.5621C51.9911 20.6387 52.6674 20.5161 53.292 20.1333C53.3813 20.0771 53.4611 20.0159 53.541 19.9444C53.6161 19.8781 53.7288 19.9342 53.7288 20.0414C53.7288 20.118 53.7288 20.1894 53.7241 20.266C53.7194 20.363 53.7429 20.3885 53.8322 20.3885C54.4991 20.3834 55.166 20.3834 55.8376 20.3885C55.9832 20.3885 56.1053 20.2609 56.1053 20.1027C56.1053 17.1828 56.11 14.2783 56.11 11.3788ZM53.6678 16.7438C53.3719 17.535 52.705 18.0149 51.9112 18.0098C50.6572 17.9893 49.8259 16.8663 49.9621 15.5544C50.0608 14.5743 50.6103 13.8903 51.4228 13.6606C52.5688 13.339 53.6772 14.166 53.8087 15.4472C53.8556 15.8964 53.8228 16.3303 53.6678 16.7438Z" fill="white"></path>
                                    <path d="M20.528 11.3792C20.528 11.3537 20.5233 11.3333 20.528 11.3129C20.5374 11.2414 20.5139 11.221 20.4435 11.221C19.7014 11.221 18.964 11.2261 18.222 11.221C18.1468 11.221 18.1421 11.2567 18.1421 11.318C18.1421 11.4048 18.1421 11.4864 18.1421 11.5783C18.1421 11.6804 18.0388 11.7366 17.959 11.6804C17.4564 11.2874 16.8928 11.0781 16.2823 11.0423C15.0846 10.9658 14.0561 11.4303 13.2388 12.3644C12.013 13.7478 11.6655 15.4221 12.1539 17.2649C12.6799 19.2506 14.3285 20.634 16.1883 20.5676C16.8365 20.5421 17.4376 20.3787 17.9543 19.9346C18.0294 19.8683 18.1421 19.9244 18.1421 20.0316C18.1421 20.1031 18.1421 20.1745 18.1374 20.246C18.1327 20.3481 18.1562 20.3736 18.2549 20.3736C18.964 20.3685 19.6685 20.3685 20.3777 20.3736C20.4951 20.3736 20.5327 20.3481 20.5327 20.2154C20.5233 17.27 20.528 14.3246 20.528 11.3792ZM18.0529 16.8208C17.7147 17.6069 17.123 17.9898 16.3809 18.0153C15.3148 18.0153 14.4834 17.1985 14.3801 16.0959C14.2862 15.1158 14.6619 14.2736 15.404 13.8499C16.5171 13.2067 17.9871 13.7988 18.222 15.4068C18.2877 15.8917 18.2455 16.3716 18.0529 16.8208Z" fill="white"></path>
                                </svg>
                            </div>
                            <span class="text-gray-800">0% Bank Installments up to 12 months.</span>
                        </div>
                        <span class="text-blue-600 font-medium">Learn more</span>
                    </div>
                </div>
            </div>


            <!-- Checkout Section -->
            <div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Price:</span>
                        <span class="font-bold" id="product-price">SAR 399.00</span>
                    </div>
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Shipping:</span>
                        <span id="product-shipping">SAR 20.00</span>
                    </div>
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Tax:</span>
                        <span id="product-tax">SAR 21.00</span>
                    </div>
                    <div class="border-t pt-4 mt-4 flex justify-between">
                        <span class="font-bold">Total:</span>
                        <span class="font-bold text-lg" id="product-total">SAR 440.00</span>
                    </div>

                    <div class="mt-6">
                        <label class="form-label" for="product-qty">Quantity:</label>
                        <div class="qty-control">
                            <button id="decrease-qty" class="qty-btn" aria-label="Decrease quantity">-</button>
                            <input type="text" id="product-qty" value="1" readonly class="qty-input" aria-label="Product quantity">
                            <button id="increase-qty" class="qty-btn" aria-label="Increase quantity">+</button>
                        </div>
                    </div>

                    <div class="mt-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium mb-3">Select Payment Method</h3>

                            <div class="space-y-3">
                                <!-- Credit Card Option -->
                                <label class="payment-option selected" id="card-payment-option">
                                    <input type="radio" name="payment-method" value="card" checked class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Credit/Debit Card</div>
                                            <div class="text-sm text-gray-600">Pay the full amount now</div>
                                        </div>
                                    </div>
                                    <div class="ml-auto">
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800">42% OFF</span>
                                    </div>
                                </label>

                                <!-- Installments Option -->
                                <label class="payment-option" id="installment-payment-option">
                                    <input type="radio" name="payment-method" value="installment" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Split Payment</div>
                                            <div class="text-sm text-gray-600">Pay in installments with your bank</div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Apple Pay Option -->
                                <label class="payment-option" id="apple-payment-option">
                                    <input type="radio" name="payment-method" value="apple" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M17.005 19.762c-.937 1.382-1.866 2.764-3.414 2.857-1.42.091-1.893-.865-3.544-.865-1.659 0-2.179.865-3.552.923-1.47.065-2.568-1.46-3.551-2.806-1.87-2.736-3.29-7.732-1.396-11.052.898-1.55 2.507-2.52 4.231-2.52 1.659-.037 3.21 1.1 4.231 1.1.939 0 2.694-1.37 4.513-1.16.768.037 2.905.316 4.276 2.318-2.058 1.244-2.986 2.87-2.986 4.876 0 2.488 1.519 4.37 3.192 5.33zm-3.245-17.098c.91-1.096 1.58-2.575 1.397-4.101-1.47.065-3.197.98-4.187 2.114-.91 1.024-1.611 2.576-1.397 4.03 1.524.073 3.116-.846 4.187-2.043z"/>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Apple Pay</div>
                                            <div class="text-sm text-gray-600">Quick checkout with Apple Pay</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Amwal Checkout Buttons Container -->
                        <div id="payment-method-buttons">
                            <!-- Credit Card Payment -->
                            <div id="card-payment" class="payment-button block">
                                <amwal-checkout-button
                                        id="card-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="440"
                                        tax="21"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay Now"
                                        address-required="true"
                                        discount="200"
                                        show-discount-ribbon="true"
                                        enable-pre-checkout-trigger="true"
                                        debug="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Installment Payment -->
                            <div id="installment-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="installment-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="440"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Split Payment"
                                        only-show-bank-installment="true"
                                        address-required="true"
                                        enable-pre-checkout-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Apple Pay -->
                            <div id="apple-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="apple-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="440"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay with Apple Pay"
                                        address-required="true"
                                        enable-apple-checkout="true"
                                        enable-pre-checkout-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Checkout Example -->
    <div id="service-content" class="card hidden" role="tabpanel" aria-labelledby="service-tab">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Service Details -->
            <div>
                <div class="bg-gray-200 h-72 rounded-lg flex items-center justify-center">
                    <span class="text-gray-500">Service Image</span>
                </div>
                <h2 class="text-xl font-bold mt-4">Premium Website Development</h2>
                <div class="flex items-center mt-2">
                    <div class="flex text-yellow-400">
                        <!-- 5 stars -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                    </div>
                    <span class="text-gray-600 ml-2">5.0 (53 reviews)</span>
                </div>
                <p class="text-gray-600 mt-4">Professional website development service tailored to your business needs. Includes responsive design, SEO optimization, and user-friendly interface.</p>

                <div class="mt-4">
                    <h3 class="font-semibold">Service Includes:</h3>
                    <ul class="list-disc pl-5 mt-2 text-gray-600">
                        <li>Custom design based on your requirements</li>
                        <li>Mobile-responsive layout</li>
                        <li>Basic SEO setup</li>
                        <li>Contact form integration</li>
                        <li>3 rounds of revisions</li>
                    </ul>
                </div>
            </div>

            <!-- Checkout Section -->
            <div>
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-between mb-4">
                        <span class="font-medium">Base Price:</span>
                        <span class="font-bold">SAR 2,499.00</span>
                    </div>

                    <div class="mt-4 mb-6">
                        <h3 class="font-semibold mb-3">Select Package:</h3>
                        <div class="space-y-3">
                            <label class="payment-option selected" id="basic-package-option">
                                <input type="radio" name="service-package" value="basic" checked class="mr-3">
                                <div>
                                    <div class="font-medium">Basic Package</div>
                                    <div class="text-sm text-gray-600">5-page website with basic features</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 2,499.00</div>
                            </label>
                            <label class="payment-option" id="standard-package-option">
                                <input type="radio" name="service-package" value="standard" class="mr-3">
                                <div>
                                    <div class="font-medium">Standard Package</div>
                                    <div class="text-sm text-gray-600">10-page website with blog integration</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 3,999.00</div>
                            </label>
                            <label class="payment-option" id="premium-package-option">
                                <input type="radio" name="service-package" value="premium" class="mr-3">
                                <div>
                                    <div class="font-medium">Premium Package</div>
                                    <div class="text-sm text-gray-600">E-commerce website with payment integration</div>
                                </div>
                                <div class="ml-auto font-medium">SAR 5,999.00</div>
                            </label>
                        </div>
                    </div>

                    <div class="border-t pt-4 mt-4 flex justify-between">
                        <span class="font-bold">Total:</span>
                        <span class="font-bold text-lg" id="service-total">SAR 2,499.00</span>
                    </div>

                    <div class="mt-6">
                        <div class="mb-4">
                            <h3 class="text-lg font-medium mb-3">Select Payment Method</h3>

                            <div class="space-y-3">
                                <!-- Credit Card Option -->
                                <label class="payment-option selected" id="service-card-option">
                                    <input type="radio" name="service-payment-method" value="card" checked class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Credit/Debit Card</div>
                                            <div class="text-sm text-gray-600">Pay the full amount now</div>
                                        </div>
                                    </div>
                                    <div class="ml-auto">
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded bg-red-100 text-red-800">42% OFF</span>
                                    </div>
                                </label>

                                <!-- Installments Option -->
                                <label class="payment-option" id="service-installment-option">
                                    <input type="radio" name="service-payment-method" value="installment" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <div>
                                            <div class="font-medium">Split Payment</div>
                                            <div class="text-sm text-gray-600">Pay in installments with your bank</div>
                                        </div>
                                    </div>
                                </label>

                                <!-- Apple Pay Option -->
                                <label class="payment-option" id="service-apple-option">
                                    <input type="radio" name="service-payment-method" value="apple" class="mr-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-gray-600" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M17.005 19.762c-.937 1.382-1.866 2.764-3.414 2.857-1.42.091-1.893-.865-3.544-.865-1.659 0-2.179.865-3.552.923-1.47.065-2.568-1.46-3.551-2.806-1.87-2.736-3.29-7.732-1.396-11.052.898-1.55 2.507-2.52 4.231-2.52 1.659-.037 3.21 1.1 4.231 1.1.939 0 2.694-1.37 4.513-1.16.768.037 2.905.316 4.276 2.318-2.058 1.244-2.986 2.87-2.986 4.876 0 2.488 1.519 4.37 3.192 5.33zm-3.245-17.098c.91-1.096 1.58-2.575 1.397-4.101-1.47.065-3.197.98-4.187 2.114-.91 1.024-1.611 2.576-1.397 4.03 1.524.073 3.116-.846 4.187-2.043z"/>
                                        </svg>
                                        <div>
                                            <div class="font-medium">Apple Pay</div>
                                            <div class="text-sm text-gray-600">Quick checkout with Apple Pay</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Service Amwal Checkout Buttons -->
                        <div id="service-payment-buttons">
                            <!-- Credit Card Payment -->
                            <div id="service-card-payment" class="payment-button block">
                                <amwal-checkout-button
                                        id="service-card-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay Now"
                                        address-required="false"
                                        email-required="true"
                                        discount="200"
                                        show-discount-ribbon="true"
                                        enable-pre-checkout-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Installment Payment -->
                            <div id="service-installment-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="service-installment-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Split Payment"
                                        only-show-bank-installment="true"
                                        address-required="false"
                                        email-required="true"
                                        enable-pre-checkout-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>

                            <!-- Apple Pay -->
                            <div id="service-apple-payment" class="payment-button hidden">
                                <amwal-checkout-button
                                        id="service-apple-checkout"
                                        merchant-id="sandbox-amwal-e09ee380-d8c7-4710-a6ab-c9b39c7ffd47"
                                        test-environment="qa"
                                        amount="2499"
                                        country-code="SA"
                                        locale="en"
                                        dark-mode="off"
                                        label="Pay with Apple Pay"
                                        address-required="false"
                                        enable-apple-checkout="true"
                                        email-required="true"
                                        enable-pre-checkout-trigger="true"
                                        class="w-full">
                                </amwal-checkout-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Integration Security Overview -->
    <div class="card">
        <div class="pb-2 flex items-center justify-between">
            <h2 class="text-xl font-semibold text-blue-700">Integration Security Overview</h2>
        </div>
        <p class="text-gray-700 mb-4">
            Ensuring secure and reliable transactions is central to Amwal Checkout. Below is a comprehensive overview of the security measures implemented throughout the integration lifecycle.
        </p>
        <div class="mt-4">
            <input type="checkbox" id="toggle-security" class="peer hidden">
            <label for="toggle-security" class="flex justify-between items-center cursor-pointer text-blue-600 font-medium mb-2">
                <span>View Details</span>
                <svg class="h-5 w-5 transform transition-transform duration-300 peer-checked:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </label>
            <div class="max-h-0 overflow-hidden transition-all duration-500 peer-checked:max-h-[1000px]">
                <ul class="list-disc pl-5 space-y-3 text-gray-600">
                    <li>
                        <strong>End-to-End Encryption:</strong>
                        All communication between the client (browser/mobile) and Amwal servers is protected using <span class="font-medium">TLS 1.2+</span> with enforced HTTPS. No sensitive data is transmitted over plain channels.
                    </li>
                    <li>
                        <strong>PCI DSS Compliance:</strong>
                        Amwal’s checkout button is a hosted solution, meaning <span class="font-medium">payment details never touch the merchant’s servers</span>. This reduces your PCI scope and ensures compliance with industry standards.
                    </li>
                    <li>
                        <strong>Webhook Signing & Verification:</strong>
                        Amwal uses <code>HMAC-SHA256</code> to sign all webhook payloads. Merchants can verify authenticity using their secret key to ensure data integrity and source trust.
                    </li>
                    <li>
                        <strong>Pre-Checkout Triggers:</strong>
                        Use the <code>amwalPreCheckoutTrigger</code> event to inject customer data, enforce business rules, or perform fraud checks <em>before</em> the payment sheet is shown. This helps stop attacks early in the flow.
                    </li>
                    <li>
                        <strong>Real-Time Address Validation:</strong>
                        During checkout, Amwal provides dynamic address updates, and the merchant can return allowed shipping options. This reduces spoofed address attempts and ensures validated logistics.
                    </li>
                    <li>
                        <strong>Secure Sandbox Environment:</strong>
                        Developers can test integrations in a fully isolated sandbox mode that mirrors production behavior—safe for experimentation, QA, and load testing.
                    </li>
                    <li>
                        <strong>JavaScript Module Isolation:</strong>
                        The Amwal checkout is loaded via ES Modules and sandboxed into an iframe where applicable. This prevents DOM-level tampering and protects your site against script injection attacks.
                    </li>
                    <li>
                        <strong>Debug Console for Auditing:</strong>
                        The built-in debug console captures all transaction events, API calls, and error messages for developers to review and export. This helps in security audits and monitoring integration integrity.
                    </li>
                    <li>
                        <strong>Token-Based Authentication:</strong>
                        Backend endpoints communicating with Amwal must use API keys or OAuth tokens (if applicable). These should be securely stored and rotated periodically.
                    </li>
                </ul>

                <p class="mt-4 text-sm text-gray-500">
                    For full details, integration tips, and compliance support, visit the
                    <a href="https://docs.amwal.tech/security" class="text-blue-600 hover:underline">Amwal Security Documentation</a>.
                </p>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Debug Console -->
    <div id="debug-console" class="debug-console">
        <div class="flex justify-between items-center mb-2">
            <div>
                <span class="font-bold">Debug Console</span>
                <span class="ml-2">
                    <button id="debug-clear" class="text-xs bg-red-600 text-white px-2 py-1 rounded">Clear</button>
                    <button id="debug-export" class="text-xs bg-green-600 text-white px-2 py-1 rounded ml-1">Export Logs</button>
                </span>
            </div>
            <div>
                <label class="text-xs mr-2">
                    <input type="checkbox" id="debug-auto-scroll" checked> Auto-scroll
                </label>
                <select id="debug-level" class="text-xs bg-gray-800 text-white px-2 py-1 rounded">
                    <option value="DEBUG">All Levels</option>
                    <option value="INFO">Info & Above</option>
                    <option value="WARN">Warnings & Errors</option>
                    <option value="ERROR">Errors Only</option>
                </select>
            </div>
        </div>
        <div id="debug-content"></div>
    </div>
    <div id="debug-handle" class="debug-handle">Debug</div>
    <!-- Modal Overlay -->
    <div id="amwal-modal-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <!-- Modal Content -->
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                    <div class="bg-black rounded px-2 py-1 mr-2">
                        <img src="https://cdn.jsdelivr.net/npm/amwal-checkout-button@latest/dist/checkout/assets/amwal-logo.svg" alt="Amwal" class="h-4">
                    </div>
                    Installment Options
                </h3>
                <button id="amwal-modal-close" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-4">
                <div class="w-full h-96 overflow-hidden rounded">

                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script type="module">
    // Logger Module - Handles debugging and logging
    class Logger {
        constructor() {
            this.levels = {
                DEBUG: 0,
                INFO: 1,
                WARN: 2,
                ERROR: 3
            };
            this.currentLevel = this.levels.DEBUG;
            this.consoleOutput = true;
            this.entries = [];
            this.maxEntries = 100;
        }

        debug(message, data) {
            this._log(this.levels.DEBUG, message, data);
            return this;
        }

        info(message, data) {
            this._log(this.levels.INFO, message, data);
            return this;
        }

        warn(message, data) {
            this._log(this.levels.WARN, message, data);
            return this;
        }

        error(message, data) {
            this._log(this.levels.ERROR, message, data);
            return this;
        }

        _log(level, message, data) {
            this._logToConsole(level, message, data);
            this._logToDebugConsole(level, message, data);
            return this;
        }

        _logToConsole(level, message, data) {
            if (!this.consoleOutput) return;

            switch (level) {
                case this.levels.DEBUG:
                    console.debug(message, data || '');
                    break;
                case this.levels.INFO:
                    console.info(message, data || '');
                    break;
                case this.levels.WARN:
                    console.warn(message, data || '');
                    break;
                case this.levels.ERROR:
                    console.error(message, data || '');
                    break;
            }
        }

        _logToDebugConsole(level, message, data) {
            if (level < this.currentLevel) return;

            const debugContent = document.getElementById('debug-content');
            if (!debugContent) return;

            // Create log entry
            const entry = {
                timestamp: new Date(),
                level: Object.keys(this.levels)[level],
                message,
                data
            };

            // Add to entries array
            this.entries.unshift(entry);
            if (this.entries.length > this.maxEntries) {
                this.entries.pop();
            }

            // Create DOM element
            const entryDiv = document.createElement('div');
            entryDiv.className = `debug-entry ${entry.level}`;

            const timestamp = entry.timestamp.toISOString().split('T')[1].slice(0, -1);
            let content = `<span class="text-gray-400">[${timestamp}]</span> <span class="font-bold">[${entry.level}]</span> ${entry.message}`;

            if (data) {
                try {
                    if (typeof data === 'object') {
                        content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">${JSON.stringify(data, null, 2)}</pre>`;
                    } else {
                        content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">${data}</pre>`;
                    }
                } catch (e) {
                    content += `<pre class="text-xs mt-1 bg-gray-800 p-1 rounded">[Object cannot be stringified]</pre>`;
                }
            }

            entryDiv.innerHTML = content;
            debugContent.insertBefore(entryDiv, debugContent.firstChild);

            // Auto-scroll
            if (document.getElementById('debug-auto-scroll').checked) {
                debugContent.scrollTop = 0;
            }
        }

        setLevel(level) {
            if (typeof level === 'string' && this.levels[level] !== undefined) {
                this.currentLevel = this.levels[level];
            } else if (typeof level === 'number' && level >= 0 && level <= 3) {
                this.currentLevel = level;
            }
            return this;
        }

        enableConsole(enable = true) {
            this.consoleOutput = Boolean(enable);
            return this;
        }

        getEntries() {
            return [...this.entries];
        }

        clear() {
            this.entries = [];
            const debugContent = document.getElementById('debug-content');
            if (debugContent) {
                debugContent.innerHTML = '';
            }
            return this;
        }

        export() {
            const exportData = {
                timestamp: new Date().toISOString(),
                entries: this.entries
            };
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportLink = document.createElement('a');
            exportLink.setAttribute('href', dataUri);
            exportLink.setAttribute('download', `amwal-debug-${new Date().toISOString()}.json`);
            document.body.appendChild(exportLink);
            exportLink.click();
            document.body.removeChild(exportLink);
            return this;
        }
    }

    // UI Service - Handles UI related functionality
    class UIService {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                toast: document.getElementById('toast'),
                loadingOverlay: document.getElementById('loading-overlay')
            };
        }

        showToast(message, type = 'success', duration = 3000) {
            const toast = this.elements.toast;
            toast.textContent = message;
            toast.className = `toast ${type}`;

            // Use setTimeout with 10ms to allow the DOM to update before adding the visible class
            setTimeout(() => {
                toast.classList.add('visible');
            }, 10);

            // Hide toast after duration
            setTimeout(() => {
                toast.classList.remove('visible');
            }, duration);

            this.logger.debug(`Toast displayed: ${message}`, { type, duration });
            return this;
        }

        showLoading(show = true) {
            if (show) {
                this.elements.loadingOverlay.style.display = 'flex';
                this.logger.debug('Loading overlay shown');
            } else {
                this.elements.loadingOverlay.style.display = 'none';
                this.logger.debug('Loading overlay hidden');
            }
            return this;
        }
    }

    // TabManager - Handles tab switching functionality
    class TabManager {
        constructor(logger) {
            this.logger = logger;
            this.tabs = {
                product: {
                    tab: document.getElementById('product-tab'),
                    content: document.getElementById('product-content')
                },
                service: {
                    tab: document.getElementById('service-tab'),
                    content: document.getElementById('service-content')
                }
            };
            this.activeTab = 'product';
        }

        init() {
            // Switch to product tab
            this.tabs.product.tab.addEventListener('click', () => this.switchTab('product'));

            // Switch to service tab
            this.tabs.service.tab.addEventListener('click', () => this.switchTab('service'));

            this.logger.info('Tab manager initialized');
            return this;
        }

        switchTab(tabName) {
            if (tabName === this.activeTab) return;

            const tabs = Object.keys(this.tabs);

            // Update active tab
            this.activeTab = tabName;

            // Update UI
            tabs.forEach(tab => {
                if (tab === tabName) {
                    this.tabs[tab].tab.classList.add('tab-active');
                    this.tabs[tab].tab.classList.remove('tab-inactive');
                    this.tabs[tab].tab.setAttribute('aria-selected', 'true');
                    this.tabs[tab].content.classList.remove('hidden');
                } else {
                    this.tabs[tab].tab.classList.remove('tab-active');
                    this.tabs[tab].tab.classList.add('tab-inactive');
                    this.tabs[tab].tab.setAttribute('aria-selected', 'false');
                    this.tabs[tab].content.classList.add('hidden');
                }
            });

            this.logger.info(`Switched to ${tabName} tab`);
            return this;
        }
    }

    // ProductModule - Handles product-related functionality
    class ProductModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                decreaseQty: document.getElementById('decrease-qty'),
                increaseQty: document.getElementById('increase-qty'),
                productQty: document.getElementById('product-qty'),
                productPrice: document.getElementById('product-price'),
                productShipping: document.getElementById('product-shipping'),
                productTax: document.getElementById('product-tax'),
                productTotal: document.getElementById('product-total'),
                cardPayment: document.getElementById('card-payment'),
                installmentPayment: document.getElementById('installment-payment'),
                applePayment: document.getElementById('apple-payment'),
                cardCheckout: document.getElementById('card-checkout'),
                installmentCheckout: document.getElementById('installment-checkout'),
                appleCheckout: document.getElementById('apple-checkout')
            };

            this.state = {
                basePrice: 399,
                shipping: 20,
                taxRate: 0.15,
                quantity: 1,
                tax: 21,
                total: 440,
                shippingMethods: [
                    { id: 'standard', name: 'Standard Shipping', price: 20, deliveryDays: '3-5' },
                    { id: 'express', name: 'Express Shipping', price: 50, deliveryDays: '1-2' },
                    { id: 'same-day', name: 'Same Day Delivery', price: 100, deliveryDays: 'Today' }
                ],
                selectedShippingMethod: 'standard',
                demoAddress: {
                    firstName: 'Mohammed',
                    lastName: 'Al-Saud',
                    addressLine1: '123 King Fahd Road',
                    addressLine2: 'Apartment 4B',
                    city: 'Riyadh',
                    state: 'Riyadh Province',
                    postalCode: '12345',
                    country: 'SA',
                    phoneNumber: '+966501234567',
                    email: 'customer@example.com'
                }
            };
        }

        init() {
            this.initQuantity();
            this.initPaymentMethods();
            this.logger.info('Product module initialized');
            return this;
        }

        initQuantity() {
            // Decrease quantity
            this.elements.decreaseQty.addEventListener('click', () => {
                if (this.state.quantity > 1) {
                    this.state.quantity--;
                    this.updatePrice();
                    this.logger.debug('Quantity decreased', { newQuantity: this.state.quantity });
                } else {
                    this.logger.debug('Cannot decrease quantity below 1');
                }
            });

            // Increase quantity
            this.elements.increaseQty.addEventListener('click', () => {
                this.state.quantity++;
                this.updatePrice();
                this.logger.debug('Quantity increased', { newQuantity: this.state.quantity });
            });

            return this;
        }

        updatePrice() {
            const subtotal = this.state.basePrice * this.state.quantity;
            const tax = Math.round(subtotal * this.state.taxRate);
            const total = subtotal + this.state.shipping + tax;

            this.elements.productQty.value = this.state.quantity;
            this.elements.productPrice.textContent = `SAR ${subtotal.toFixed(2)}`;
            this.elements.productTax.textContent = `SAR ${tax.toFixed(2)}`;
            this.elements.productTotal.textContent = `SAR ${total.toFixed(2)}`;
            this.state.tax = tax;
            this.state.total = total;

            // Update Amwal button amounts
            this.elements.cardCheckout.setAttribute('amount', total.toString());
            this.elements.cardCheckout.setAttribute('tax', tax.toString());
            this.elements.installmentCheckout.setAttribute('amount', total.toString());
            this.elements.appleCheckout.setAttribute('amount', total.toString());

            this.logger.info('Product price updated', { subtotal, tax, total, quantity: this.state.quantity });
            return this;
        }

        initPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="payment-method"]');
            const paymentOptions = document.querySelectorAll('#product-content .payment-option');

            paymentMethods.forEach(method => {
                method.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    paymentOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`${value}-payment-option`).classList.add('selected');

                    // Show correct payment button
                    this.elements.cardPayment.classList.add('hidden');
                    this.elements.installmentPayment.classList.add('hidden');
                    this.elements.applePayment.classList.add('hidden');
                    document.getElementById(`${value}-payment`).classList.remove('hidden');

                    this.logger.info('Product payment method changed', { method: value });
                });
            });

            return this;
        }
    }

    // ServiceModule - Handles service-related functionality
    class ServiceModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                serviceTotal: document.getElementById('service-total'),
                serviceCardPayment: document.getElementById('service-card-payment'),
                serviceInstallmentPayment: document.getElementById('service-installment-payment'),
                serviceApplePayment: document.getElementById('service-apple-payment'),
                serviceCardCheckout: document.getElementById('service-card-checkout'),
                serviceInstallmentCheckout: document.getElementById('service-installment-checkout'),
                serviceAppleCheckout: document.getElementById('service-apple-checkout')
            };

            this.state = {
                packages: {
                    basic: { price: 2499, name: 'Basic Package' },
                    standard: { price: 3999, name: 'Standard Package' },
                    premium: { price: 5999, name: 'Premium Package' }
                },
                selectedPackage: 'basic',
                total: 2499
            };
        }

        init() {
            this.initPackages();
            this.initPaymentMethods();
            this.logger.info('Service module initialized');
            return this;
        }

        initPackages() {
            const servicePackages = document.querySelectorAll('input[name="service-package"]');
            const packageOptions = document.querySelectorAll('#service-content label[id$="-package-option"]');

            servicePackages.forEach(pkg => {
                pkg.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    packageOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`${value}-package-option`).classList.add('selected');

                    // Update price
                    this.updatePackage(value);

                    this.logger.info('Service package changed', { package: value });
                });
            });

            return this;
        }

        updatePackage(packageName) {
            if (this.state.packages[packageName]) {
                this.state.selectedPackage = packageName;
                this.state.total = this.state.packages[packageName].price;

                // Update UI
                this.elements.serviceTotal.textContent = `SAR ${this.state.total.toFixed(2)}`;

                // Update Amwal button amounts
                this.elements.serviceCardCheckout.setAttribute('amount', this.state.total.toString());
                this.elements.serviceInstallmentCheckout.setAttribute('amount', this.state.total.toString());
                this.elements.serviceAppleCheckout.setAttribute('amount', this.state.total.toString());

                this.logger.info('Service package updated', {
                    package: packageName,
                    price: this.state.packages[packageName].price
                });
            }
            return this;
        }

        initPaymentMethods() {
            const paymentMethods = document.querySelectorAll('input[name="service-payment-method"]');
            const paymentOptions = document.querySelectorAll('#service-content .payment-option');

            paymentMethods.forEach(method => {
                method.addEventListener('change', (event) => {
                    const value = event.target.value;

                    // Update styling
                    paymentOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    document.getElementById(`service-${value}-option`).classList.add('selected');

                    // Show correct payment button
                    this.elements.serviceCardPayment.classList.add('hidden');
                    this.elements.serviceInstallmentPayment.classList.add('hidden');
                    this.elements.serviceApplePayment.classList.add('hidden');
                    document.getElementById(`service-${value}-payment`).classList.remove('hidden');

                    this.logger.info('Service payment method changed', { method: value });
                });
            });

            return this;
        }
    }

    // CheckoutModule - Handles Amwal checkout functionality
    class CheckoutModule {
        constructor(logger, uiService, productModule, serviceModule) {
            this.logger = logger;
            this.uiService = uiService;
            this.productModule = productModule;
            this.serviceModule = serviceModule;
        }

        init() {
            this.initProductCheckoutEvents();
            this.initServiceCheckoutEvents();
            this.applyDemoDataToCheckout();
            this.logger.info('Checkout module initialized');
            return this;
        }

        initProductCheckoutEvents() {
            // Add event listeners to product checkout buttons
            const buttons = [
                { el: this.productModule.elements.cardCheckout, type: 'card' },
                { el: this.productModule.elements.installmentCheckout, type: 'installment' },
                { el: this.productModule.elements.appleCheckout, type: 'apple' }
            ];

            buttons.forEach(button => {
                if (button.el) {
                    this._addCheckoutEventListeners(button.el, button.type, true);
                }
            });

            return this;
        }

        initServiceCheckoutEvents() {
            // Add event listeners to service checkout buttons
            const buttons = [
                { el: this.serviceModule.elements.serviceCardCheckout, type: 'card' },
                { el: this.serviceModule.elements.serviceInstallmentCheckout, type: 'installment' },
                { el: this.serviceModule.elements.serviceAppleCheckout, type: 'apple' }
            ];

            buttons.forEach(button => {
                if (button.el) {
                    this._addCheckoutEventListeners(button.el, button.type, false);
                }
            });

            return this;
        }

        _addCheckoutEventListeners(button, buttonType, isProduct = true) {
            const productOrService = isProduct ? 'Product' : 'Service';

            button.addEventListener('amwalPreCheckoutTrigger', (event) => {
                this.logger.info(`${productOrService} pre-checkout triggered`, event.detail);

                // Only add demo data for product checkout
                if (isProduct) {
                    // Get transaction details from the event
                    const transactionDetails = event.detail || {};

                    // Get your demo data
                    const demoAddress = this.productModule.state.demoAddress;
                    const shippingMethod = this.productModule.state.shippingMethods.find(
                        method => method.id === this.productModule.state.selectedShippingMethod
                    );

                    // Create modified transaction details with demo data
                    const modifiedDetails = {
                        ...transactionDetails,
                        customerDetails: {
                            firstName: demoAddress.firstName,
                            lastName: demoAddress.lastName,
                            email: demoAddress.email,
                            phoneNumber: demoAddress.phoneNumber
                        },
                        shippingAddress: {
                            addressLine1: demoAddress.addressLine1,
                            addressLine2: demoAddress.addressLine2,
                            city: demoAddress.city,
                            state: demoAddress.state,
                            postalCode: demoAddress.postalCode,
                            country: demoAddress.country
                        },
                        shippingMethod: {
                            id: shippingMethod.id,
                            name: shippingMethod.name,
                            price: shippingMethod.price,
                            description: `${shippingMethod.name} (${shippingMethod.deliveryDays})`
                        }
                    };

                    this.logger.debug('Sending demo data to Amwal', modifiedDetails);

                    // Send modified transaction details back to Amwal
                    button.dispatchEvent(new CustomEvent('amwalPreCheckoutTriggerAck', {
                        detail: modifiedDetails
                    }));
                } else {
                    // For services, just acknowledge without modification
                    button.dispatchEvent(new CustomEvent('amwalPreCheckoutTriggerAck'));
                }
            });

            // Original checkout events
            button.addEventListener('amwalCheckoutStart', (event) => {
                this.logger.info(`${productOrService} ${buttonType} checkout started`, event.detail);
                this.uiService.showLoading(true);
            });

            button.addEventListener('amwalCheckoutSuccess', (event) => {
                this.logger.info(`${productOrService} ${buttonType} checkout success`, event.detail);
                this.uiService.showLoading(false);
                this.uiService.showToast(`Checkout successful! Order ID: ${event.detail.orderId}`, 'success');
                this.logger.debug('Order details', { orderId: event.detail.orderId });
            });

            button.addEventListener('amwalCheckoutFail', (event) => {
                this.logger.error(`${productOrService} ${buttonType} checkout failed`, event.detail);
                this.uiService.showLoading(false);
                this.uiService.showToast('Checkout failed. Please try again.', 'error');
            });

            // Address events
            button.addEventListener('amwalAddressCountryUpdate', (event) => {
                this.logger.info(`${productOrService} address country updated`, event.detail);
                const country = event.detail;
                this.logger.debug('Country details', country);
            });

            button.addEventListener('amwalAddressStateUpdate', (event) => {
                this.logger.info(`${productOrService} address state updated`, event.detail);
                const state = event.detail;
                this.logger.debug('State details', state);
            });

            button.addEventListener('amwalAddressUpdate', (event) => {
                this.logger.info(`${productOrService} address updated`, event.detail);

                // Only handle shipping methods for products
                if (isProduct) {
                    const address = event.detail;
                    this.logger.debug('Address update received', address);

                    // Get available shipping methods based on the country and city
                    const country = address.country;
                    const city = address.city;

                    // You could customize shipping methods based on location
                    let availableShippingMethods = this.productModule.state.shippingMethods;

                    // Example: If shipping to Riyadh, offer same-day delivery
                    if (country === 'SA' && city === 'Riyadh') {
                        // All shipping methods available
                    }
                    // If shipping to other SA cities, no same-day but express is available
                    else if (country === 'SA') {
                        availableShippingMethods = availableShippingMethods.filter(
                            method => method.id !== 'same-day'
                        );
                    }
                    // International shipping - only standard shipping
                    else {
                        availableShippingMethods = availableShippingMethods.filter(
                            method => method.id === 'standard'
                        );
                    }

                    const shippingOptions = availableShippingMethods.map(method => ({
                        id: method.id,
                        label: method.name,
                        price: method.price,
                    }));

                    this.logger.debug('Sending shipping options to Amwal', shippingOptions);

                    // Create and dispatch the acknowledgment event with shipping options
                    button.dispatchEvent(new CustomEvent('amwalAddressAck', {
                        detail: shippingOptions
                    }));
                }
            });

            button.addEventListener('amwalDismissed', (event) => {
                this.logger.info(`${productOrService} checkout dismissed`, event.detail);
                this.uiService.showLoading(false);
                // Handle modal dismissal
                const isSuccessful = event.detail;
                if (!isSuccessful) {
                    this.uiService.showToast('Checkout was cancelled.', 'error');
                }
            });

            button.addEventListener('updateOrderOnPaymentsuccess', (event) => {
                this.logger.info(`${productOrService} order updated after payment`, event.detail);
                // Update order status in your system
                const orderDetails = event.detail;
                this.logger.debug('Updated order details', orderDetails);
            });
        }

        applyDemoDataToCheckout() {
            // Product checkout buttons
            const productCheckoutButtons = [
                this.productModule.elements.cardCheckout,
                this.productModule.elements.installmentCheckout,
                this.productModule.elements.appleCheckout
            ];

            const serviceCheckoutButtons = [
                this.serviceModule.elements.serviceCardCheckout,
                this.serviceModule.elements.serviceInstallmentCheckout,
                this.serviceModule.elements.serviceAppleCheckout
            ];

            // Define shipping methods
            const shippingMethodsData = [
                {
                    id: 'standard',
                    label: 'Standard Shipping',
                    price: 20,
                },
                {
                    id: 'express',
                    label: 'Express Shipping',
                    price: 50,
                },
                {
                    id: 'same-day',
                    label: 'Same Day Delivery',
                    price: 100,
                }
            ];

            // Define all our allowed addresses data
            const addressData = {
                // Initial customer data
                initialFirstName: "Mohammed",
                initialLastName: "Al-Saud",
                initialPhoneNumber: "+966501234567",
                initialEmail: "customer@example.com",

                // Initial address as JSON string
                initialAddress: JSON.stringify({
                    street1: "123 King Fahd Road",
                    street2: "Apartment 4B",
                    city: "Riyadh",
                    state: "Riyadh",
                    country: "SA",
                    postcode: "12345"
                }),

                // Allowed countries
                allowedAddressCountries: JSON.stringify(["SA", "AE", "KW", "US"]),

                // Allowed states by country
                allowedAddressStates: JSON.stringify({
                    "SA": {
                        "1115": "Riyadh",
                        "1119": "Dammam",
                        "1121": "Jeddah",
                        "1122": "Mecca"
                    },
                    "AE": {
                        "1108": "Abu Dhabi",
                        "1111": "Dubai",
                        "1114": "Sharjah"
                    }
                }),

                // Allowed cities by country and state
                allowedAddressCities: JSON.stringify({
                    "SA": {
                        "1115": ["Riyadh"],
                        "1119": ["Dammam"]
                    }
                }),

                // Countries where postcode is optional
                postcodeOptionalCountries: JSON.stringify(["SA"]),

                // Feature flags
                addressHandshake: "",
                sendExtraAddressFields: "",
                enablePrePayTrigger: "",
                enablePreCheckoutTrigger: ""
            };

            // Apply all attributes to each button
            this._applyAttributesToButtons(productCheckoutButtons, addressData, shippingMethodsData, true);
            this._applyAttributesToButtons(serviceCheckoutButtons, addressData, null, false);

            this.logger.info('Demo customer and address data applied to checkout buttons', {
                customerData: {
                    firstName: addressData.initialFirstName,
                    lastName: addressData.initialLastName,
                    phoneNumber: addressData.initialPhoneNumber,
                    email: addressData.initialEmail
                },
                addressData: JSON.parse(addressData.initialAddress),
                allowedCountries: JSON.parse(addressData.allowedAddressCountries)
            });

            return this;
        }

        _applyAttributesToButtons(buttons, addressData, shippingMethodsData, isProduct) {
            buttons.forEach(button => {
                if (!button) return;

                // Set customer information
                button.setAttribute('initial-first-name', addressData.initialFirstName);
                button.setAttribute('initial-last-name', addressData.initialLastName);
                button.setAttribute('initial-phone-number', addressData.initialPhoneNumber);
                button.setAttribute('initial-email', addressData.initialEmail);

                // Set address information
                button.setAttribute('initial-address', addressData.initialAddress);

                // Set address restrictions
                button.setAttribute('allowed-address-countries', addressData.allowedAddressCountries);
                button.setAttribute('allowed-address-states', addressData.allowedAddressStates);
                button.setAttribute('allowed-address-cities', addressData.allowedAddressCities);
                button.setAttribute('postcode-optional-countries', addressData.postcodeOptionalCountries);

                // Set feature flags
                button.setAttribute('address-handshake', addressData.addressHandshake);
                button.setAttribute('send-extra-address-fields', addressData.sendExtraAddressFields);
                button.setAttribute('enable-pre-pay-trigger', addressData.enablePrePayTrigger);
                button.setAttribute('enable-pre-checkout-trigger', addressData.enablePreCheckoutTrigger);

                // Dynamic shipping details is not needed if we're providing allowed addresses
                button.setAttribute('enable-dynamic-shipping-details', 'false');

                // Only add shipping methods to product buttons
                if (isProduct && shippingMethodsData) {
                    button.setAttribute('shipping-methods', JSON.stringify(shippingMethodsData));
                }
            });
        }
    }

    // DebugModule - Handles debug console functionality
    class DebugModule {
        constructor(logger) {
            this.logger = logger;
            this.elements = {
                debugConsole: document.getElementById('debug-console'),
                debugHandle: document.getElementById('debug-handle'),
                debugContent: document.getElementById('debug-content'),
                debugClear: document.getElementById('debug-clear'),
                debugExport: document.getElementById('debug-export'),
                debugLevel: document.getElementById('debug-level'),
                debugAutoScroll: document.getElementById('debug-auto-scroll')
            };
        }

        init() {
            // Toggle debug console visibility
            this.elements.debugHandle.addEventListener('click', () => {
                const debugConsole = this.elements.debugConsole;
                if (debugConsole.style.display === 'block') {
                    debugConsole.style.display = 'none';
                } else {
                    debugConsole.style.display = 'block';
                }
                this.logger.debug('Debug console toggled');
            });

            // Clear debug console
            this.elements.debugClear.addEventListener('click', () => {
                this.logger.clear();
                this.logger.info('Debug console cleared');
            });

            // Export debug logs
            this.elements.debugExport.addEventListener('click', () => {
                this.logger.export();
                this.logger.info('Debug logs exported');
            });

            // Change debug level
            this.elements.debugLevel.addEventListener('change', (event) => {
                const level = event.target.value;
                this.logger.setLevel(level);
                this.logger.info('Debug level changed', { level });
            });

            this.logger.info('Debug module initialized');
            return this;
        }
    }

    // InstallmentCTAModule - Handles the installment CTA buttons and modal
    class InstallmentCTAModule {
        constructor(logger, productModule, serviceModule) {
            this.logger = logger;
            this.productModule = productModule;
            this.serviceModule = serviceModule;
            this.elements = {
                // Main modal elements
                modalOverlay: document.getElementById('amwal-modal-overlay'),
                modalClose: document.getElementById('amwal-modal-close'),
                installmentCta: document.getElementById('amwal-installment-cta'),
                iframe: document.getElementById('amwal-iframe'),

                // CTA buttons
                productCtaButton: document.querySelector('#product-content #installment-cta-button'),
                serviceCtaButton: document.querySelector('#service-content #installment-cta-button')
            };

            this.activeTab = 'product'; // Default active tab
        }

        init() {
            this.initModalHandlers();
            this.initCTAButtons();
            this.logger.info('Installment CTA module initialized');
            return this;
        }

        initModalHandlers() {
            // Close modal when X button is clicked
            if (this.elements.modalClose) {
                this.elements.modalClose.addEventListener('click', () => this.closeModal());
            }

            // Close modal when clicking outside the modal content
            if (this.elements.modalOverlay) {
                this.elements.modalOverlay.addEventListener('click', (event) => {
                    if (event.target === this.elements.modalOverlay) {
                        this.closeModal();
                    }
                });
            }

            // Close modal and select installment payment option when CTA button is clicked
            if (this.elements.installmentCta) {
                this.elements.installmentCta.addEventListener('click', () => {
                    this.closeModal();

                    // Select the appropriate installment option based on active tab
                    if (this.activeTab === 'product') {
                        // Try to find and click the product installment payment option
                        const installmentOption = document.querySelector('input[name="payment-method"][value="installment"]');
                        if (installmentOption) {
                            installmentOption.checked = true;
                            installmentOption.dispatchEvent(new Event('change', { bubbles: true }));

                            // Scroll to the payment section
                            const paymentSection = document.getElementById('installment-payment');
                            if (paymentSection) {
                                paymentSection.scrollIntoView({ behavior: 'smooth' });
                            }
                        }
                    } else {
                        // Try to find and click the service installment payment option
                        const serviceInstallmentOption = document.querySelector('input[name="service-payment-method"][value="installment"]');
                        if (serviceInstallmentOption) {
                            serviceInstallmentOption.checked = true;
                            serviceInstallmentOption.dispatchEvent(new Event('change', { bubbles: true }));

                            // Scroll to the payment section
                            const paymentSection = document.getElementById('service-installment-payment');
                            if (paymentSection) {
                                paymentSection.scrollIntoView({ behavior: 'smooth' });
                            }
                        }
                    }

                    this.logger.info('Installment payment option selected');
                });
            }
        }

        initCTAButtons() {
            // Product CTA button
            if (this.elements.productCtaButton) {
                this.elements.productCtaButton.addEventListener('click', () => {
                    this.activeTab = 'product';
                    this.updateIframeForProduct();
                    this.openModal();
                    this.logger.info('Product installment CTA clicked');
                });
            }

            // Service CTA button
            if (this.elements.serviceCtaButton) {
                this.elements.serviceCtaButton.addEventListener('click', () => {
                    this.activeTab = 'service';
                    this.updateIframeForService();
                    this.openModal();
                    this.logger.info('Service installment CTA clicked');
                });
            }

            // Update iframe URL when product quantity changes
            const quantityButtons = document.querySelectorAll('#increase-qty, #decrease-qty');
            if (quantityButtons.length) {
                quantityButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Only update if modal is open and active tab is product
                        if (!this.elements.modalOverlay.classList.contains('hidden') && this.activeTab === 'product') {
                            this.updateIframeForProduct();
                        }
                    });
                });
            }

            // Update iframe URL when service package changes
            const servicePackages = document.querySelectorAll('input[name="service-package"]');
            if (servicePackages.length) {
                servicePackages.forEach(pkg => {
                    pkg.addEventListener('change', () => {
                        // Only update if modal is open and active tab is service
                        if (!this.elements.modalOverlay.classList.contains('hidden') && this.activeTab === 'service') {
                            this.updateIframeForService();
                        }
                    });
                });
            }
        }

        updateIframeForProduct() {
            if (!this.elements.iframe) return;

            // Get the current product total
            const totalElement = document.getElementById('product-total');
            const totalText = totalElement ? totalElement.textContent : 'SAR 440.00';

            // Extract the number from the total (assuming format "SAR XXX.XX")
            const totalMatch = totalText.match(/SAR\s+([\d,]+\.?\d*)/);
            const totalAmount = totalMatch ? parseFloat(totalMatch[1].replace(',', '')) : 440;

            // Round to whole number
            const roundedAmount = Math.round(totalAmount);

            // Update iframe URL
            this.elements.iframe.src = `https://qa-pay.sa.amwal.tech/installment-promotion?price=${roundedAmount}&currency=SAR&installmentsCount=12&locale=en`;
            this.logger.debug('Product iframe updated', { amount: roundedAmount });
        }

        updateIframeForService() {
            if (!this.elements.iframe) return;

            // Get the current service total
            const totalElement = document.getElementById('service-total');
            const totalText = totalElement ? totalElement.textContent : 'SAR 2,499.00';

            // Extract the number from the total (assuming format "SAR X,XXX.XX")
            const totalMatch = totalText.match(/SAR\s+([\d,]+\.?\d*)/);
            const totalAmount = totalMatch ? parseFloat(totalMatch[1].replace(',', '')) : 2499;

            // Round to whole number
            const roundedAmount = Math.round(totalAmount);

            // Update iframe URL
            this.elements.iframe.src = `https://qa-pay.sa.amwal.tech/installment-promotion?price=${roundedAmount}&currency=SAR&installmentsCount=12&locale=en`;
            this.logger.debug('Service iframe updated', { amount: roundedAmount });
        }

        openModal() {
            this.elements.modalOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
            this.logger.debug('Installment modal opened');
        }

        closeModal() {
            this.elements.modalOverlay.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
            this.logger.debug('Installment modal closed');
        }
    }

    // AmwalCheckoutApp - Main application class
    class AmwalCheckoutApp {
        constructor() {
            // Initialize logger first
            this.logger = new Logger();
            this.logger.info('Initializing Amwal Checkout application', { timestamp: new Date().toISOString() });

            // Initialize services and modules
            this.uiService = new UIService(this.logger);
            this.tabManager = new TabManager(this.logger);
            this.productModule = new ProductModule(this.logger);
            this.serviceModule = new ServiceModule(this.logger);
            this.checkoutModule = new CheckoutModule(this.logger, this.uiService, this.productModule, this.serviceModule);
            this.debugModule = new DebugModule(this.logger);
            this.installmentCTAModule = new InstallmentCTAModule(this.logger, this.productModule, this.serviceModule);
        }

        init() {
            // Initialize all modules
            this.tabManager.init();
            this.productModule.init();
            this.serviceModule.init();
            this.checkoutModule.init();
            this.debugModule.init();
            const originalInit = AmwalCheckoutApp.prototype.init;
            if (this.installmentCTAModule) {
                this.installmentCTAModule.init();
            }
            this.logger.info('AmwalCheckoutApp initialized successfully');
            return this;
        }
    }

    // Initialize the application when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        const app = new AmwalCheckoutApp();
        app.init();
    });
</script>
</body>
</html>
